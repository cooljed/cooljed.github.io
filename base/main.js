/*! Coolj/Tpb@tQuery v0.2.0 | (c) zhliner@gmail.com 2022.01.19. */
import e,{OBTA as t,TplsPool as n,TplrName as r,tplMaps as l,DEBUG as o}from"./tpb/config.js";import{processProxy as i,processExtend as s,customGetter as a,BaseOn as u,BaseBy as c,Tpb as f,obtBuilder as d}from"./tpb/tpb.esm.js";import{HotKey as p,ObjKey as h}from"./tpb/tools/hotkey.js";import{Scripter as m,By as g,Sys as _,Limit as w,On as v,ROOT as y,Local as b,Cmdx as x,Tips as E,Fx as T,Help as C}from"../config.js";import N from"./shortcuts.js";import{Render as S}from"./tpb/tools/render.js";import{Spliter as $,UmpCaller as A,UmpString as k,UmpChars as O}from"./tpb/tools/spliter.js";import{MdLine as R}from"./hlparse/languages/mdline.js";import{Hicolor as I}from"./hlparse/main.js";import{Util as L}from"./tpb/tools/util.js";import{Templater as z}from"./tpb/tools/templater.js";import{Loader as U,TplLoader as D}from"./tpb/tools/tloader.js";
//! $ID: types.js 2020.05.09 Cooljed.Libs $
const H=1,M=2,F=6,j=8,P=100,B=101,K=102,V=103,W=104,G=105,X=106,q=107,J=200,Y=201,Q=202,Z=203,ee=204,te=205,ne=206,re=207,le=208,oe=209,ie=210,se=211,ae=212,ue=213,ce=214,fe=215,de=216,pe=217,he=218,me=219,ge=220,_e=221,we=300,ve=301,ye=302,be=303,xe=304,Ee=400,Te=401,Ce=402,Ne=403,Se=404,$e=405,Ae=406,ke=407,Oe=408,Re=409,Ie=410,Le=411,ze=412,Ue=413,De=414,He=418,Me=419,Fe=420,je=421,Pe=422,Be=423,Ke=501,Ve=502,We=503,Ge=504,Xe=505,qe=506,Je=510,Ye=511,Qe=513,Ze=514,et=515,tt=516,nt=517,rt=518,lt=519,ot=520,it=523,st=524,at=525,ut=527,ct=-1,ft=-2,dt={0:0,[M]:4114,[H]:4114,3:4114,4:4114,5:4626,[F]:4624,7:528,[j]:4240,9:400,10:400,108:6,[P]:390,[B]:390,[K]:390,[V]:130,[X]:6,[q]:14,104:3082,[G]:3842,[J]:4120,[Y]:4120,[Q]:4120,[Z]:4120,[ee]:4120,[te]:4120,[ne]:4120,[re]:4120,[le]:4120,[oe]:4120,[ie]:4120,[se]:4120,[ae]:4120,[ue]:4120,[ce]:4120,[fe]:4120,[de]:4120,[pe]:4120,[he]:4120,[me]:4120,[ge]:4120,[_e]:4120,[we]:40,[ve]:40,[ye]:40,[xe]:40,[be]:40,[Ee]:1098,[Te]:1098,[Ce]:14,[Ne]:1098,[Se]:3146,[$e]:14,[Ae]:1098,[ke]:78,[Oe]:1102,[Re]:14,[Ie]:14,[Le]:14,[ze]:10,[Ue]:10,[De]:6,416:2,415:70,417:70,[He]:518,[Me]:14,[Fe]:3146,[je]:518,[Pe]:518,[Be]:518,424:3586,425:6,500:1122,[qe]:1122,507:1634,509:34,508:34,[Je]:1122,[Ye]:2146,512:98,[Ke]:34,[Ve]:34,[We]:34,[Ge]:34,[Xe]:34,[Qe]:34,[Ze]:34,[et]:34,[tt]:34,[nt]:34,[rt]:34,[lt]:34,[ot]:34,521:34,522:34,[it]:34,[st]:34,[at]:34,526:34,[ut]:160,528:544,[ct]:13,[ft]:13},pt=[Y,Q,te,ne,re,le,5,oe,ie,se,ae,ue,ce,fe,de,pe,he,_e],ht=[Z,ee,me,ge],mt=[9,10,7],gt=[...[H,M,3,4,F,j],...pt,...ht,...mt],_t=[...pt,...ht,...mt],wt=[...ht,...mt],vt=[it,st,Ze,et],yt=[we,ve,ye,be,Ze,et,tt,nt,rt,lt,ot,521,522,it,st,at,526,528],bt={0:null,[H]:[0,B,P],[M]:[0,B,P],3:[K,V],4:[108],5:[0,104,G],[F]:[0],7:null,[j]:null,9:null,10:null,108:[108],[P]:null,[B]:null,[K]:null,[V]:null,104:[0],[G]:[0],[X]:[j,4],[q]:[0,J,..._t],[J]:[0,...gt],[Y]:[0,J,...gt,4,j],[Q]:[0,...ht],[Z]:[0,J,...pt,...mt],[ee]:[0,J,...pt,...mt],[te]:[0,Q,...wt],[ne]:[0,...pt,...ht],[re]:[0,...ht],[le]:[0,ct,ft],[oe]:[0,...wt],[ie]:[0,...wt],[se]:[0,...wt],[ae]:[0,...wt],[ue]:[0,...wt],[ce]:[0,...wt],[fe]:[0,..._t],[de]:[0],[pe]:[0,...ht],[he]:[0,...ht],[me]:[0,..._t],[ge]:[0,..._t],[_e]:[0,...ht],[we]:[0,J,...gt,ct,ft],[ve]:[0,J,...gt,ct,ft],[ye]:[0,J,...gt,ct,ft],[be]:[0,J,..._t],[xe]:[0,J,...gt,ct,ft],[Ee]:[0,J,..._t,4,j,ft],[Te]:[0,J,..._t,4,j,ft],[Ce]:[0,J,..._t,4,j,ft],[Ne]:[0,J,..._t,4,j,ft],[Se]:[0,J,..._t,4,j,ft],[$e]:[0,J,..._t,4,j,ft],[Ae]:[0,J,..._t,ft],[ke]:[0,J,..._t,ft],[Oe]:[0,J,..._t,ft],[Ie]:[0,J,..._t,4,j,ft],[Re]:[0,J,...gt],[Le]:[0,J,...gt],[ze]:[0,J,...gt],[Ue]:[0,J,...gt],[De]:[ze,Ue],415:[De],416:[De],417:[De],[He]:[le],[Me]:[J],[Fe]:[J],[je]:[Ne,Ze],[Pe]:[Ne,et],[Be]:[Fe,et],424:[Me,Be],425:[j,4,q,X],500:[Ee,Ce],[qe]:[Ne,we,...vt],507:[Ne,424],508:[Ne,et],509:[Ne,Ze],[Je]:[Ne,we,ye,ve,...vt,nt,rt],[Ye]:[Ne,we,ye,ve,...vt,xe],[Ze]:[Re,Me],[et]:[Re,Me],[tt]:[He],[nt]:[Re,Me,je,Pe],[rt]:[Re,Me,je,Pe],[lt]:[Re,Me,Pe,Be],[ot]:[Ie,Le],521:[Oe,415,416,417],522:[ke,425],[it]:[Ne,we,...vt,521],[st]:[Ne,we,...vt,521],[at]:[Ae,we,...vt,521],526:[le],[ut]:null,528:null,[ct]:[0,J],[ft]:[0,J],[-10]:[Ee,500,qe,507,512,508,509,Ye]};e.each(bt,((e,t,n)=>n[t]=e&&new Set(e)));const xt={512:[Je,Ye,ut,Ke],[Ke]:[Te,Je,Ye,ut,Ve],[Ve]:[Te,Je,Ye,ut,We],[We]:[Te,Je,Ye,ut,Ge],[Ge]:[Te,Je,Ye,ut,Xe],[Xe]:[Te,Je,Ye,ut,Qe],[Qe]:[Te,Je,Ye,ut,Qe]};function Et(e){return!!(128&dt[e])}function Tt(e){return!!(64&dt[e])}function Ct(e){return!!(256&dt[e])}function Nt(e){return!!(1024&dt[e])}function St(e){return!!(2048&dt[e])}function $t(e){return!!(1024&dt[e]&&2048&dt[e])}function At(e){return!!(512&dt[e])}function kt(e){return!!(32&dt[e])}function Ot(e){return!!(16&dt[e])}function Rt(e){return!!(4096&dt[e])}function It(e){return!!(8&dt[e])}function Lt(e){return!!(4&dt[e])}function zt(e){return!!(1&dt[e])}function Ut(e){let t=bt[e];return!!t&&1===t.size&&t.has(0)}function Dt(t){let n=e.not(e.children(t),"h2,header,footer,hr"),r=e.filter(n,"section");return n.length?r.length?n.length===r.length?2:3:1:0}function Ht(e,t){switch(Dt(e)){case 1:return t.slice(0,-1).concat(yt);case 2:return t}return t.concat(yt)}var Mt=Object.freeze({__proto__:null,$TEXT:0,AUDIO:H,VIDEO:M,PICTURE:3,SVG:4,RUBY:5,METER:F,SPACE:7,IMG:j,BR:9,WBR:10,TRACK:P,SOURCE1:B,SOURCE2:K,PIMG:V,RT:104,RP:G,FCONA:X,EXPLAIN:q,SVGITEM:108,A:J,Q:Y,ABBR:Q,DEL:Z,INS:ee,DFN:te,BDO:ne,TIME:re,CODE:le,STRONG:oe,EM:ie,CITE:se,SMALL:ae,SUB:ue,SUP:ce,MARK:fe,ORZ:de,SAMP:pe,KBD:he,S:me,U:ge,VAR:_e,P:we,NOTE:ve,TIPS:ye,PRE:be,ADDRESS:xe,H1:Ee,H2:Te,H3:Ce,H4:Ne,H5:Se,H6:$e,SUMMARY:Ae,FIGCAPTION:ke,CAPTION:Oe,LI:Re,DT:Ie,DD:Le,TH:ze,TD:Ue,TR:De,THEAD:415,TBODY:416,TFOOT:417,CODELI:He,ALI:Me,AH5:Fe,XH5LI:je,XOLH5LI:Pe,XOLAH5LI:Be,TOCCASCADE:424,FIGCONBOX:425,HGROUP:500,S1:Ke,S2:Ve,S3:We,S4:Ge,S5:Xe,ABSTRACT:qe,TOC:507,REFERENCE:508,SEEALSO:509,HEADER:Je,FOOTER:Ye,ARTICLE:512,SECTION:Qe,UL:Ze,OL:et,CODELIST:tt,ULX:nt,OLX:rt,CASCADE:lt,DL:ot,TABLE:521,FIGURE:522,BLOCKQUOTE:it,ASIDE:st,DETAILS:at,CODEBLOCK:526,HR:ut,BLANK:528,B:ct,I:ft,MAIN:-10,ChildTypes:bt,ChildTypesX:xt,isEmpty:Et,isSingle:Tt,isCovert:Ct,isFixed1:Nt,isFixed2:St,isFixed:$t,isFixedAny:function(e){return!!(1024&dt[e]||2048&dt[e])},isSealed:At,isBlocks:kt,isInlines:Ot,isRangeX:Rt,isContent:It,isStruct:function(e){return!!(2&dt[e])},isStructX:Lt,isSpecial:zt,onlyText:Ut,sectionState:Dt,sectionSubs:Ht});
//! $ID: base.js 2020.05.10 Cooljed.Libs $
const Ft=Symbol("type-value"),jt=new WeakMap,Pt=new Set(["abstract","toc","seealso","reference","s1","s2","s3","s4","s5","codelist","ulx","olx","cascade","codeblock","note","tips","blank","orz","space","explain"]),Bt=new Set([415,417,Ee,Ae,qe,507,424,508,512,q,V]),Kt={LI(t,n){let r=t.firstElementChild;return t.childElementCount<=1?n&&function(t,n){if(!t||e.siblingNodes(t).length)return;if("A"===t.tagName)return Me;return"CODE"===t.tagName&&"OL"===n.tagName&&rn(n)===tt&&He}(r,n)||Re:2===t.childElementCount&&"H5"===r.tagName?tn(r):Re},H5:e=>nn(e,"A")?Fe:Se,SPAN:(e,t)=>t&&"FIGURE"===t.tagName?425:e.hasAttribute("space")&&!e.childNodes.length?7:null,IMG:(e,t)=>3===(t&&rn(t))?V:j,SOURCE:(e,t)=>"PICTURE"===t.tagName?K:B,A:(e,t)=>t&&425===rn(t)?X:J},Vt={LI:[{type:He,check:e=>nn(e,"CODE")},{type:Me,check:e=>nn(e,"A")},{type:Be,check:function(e){let t=e.firstElementChild;return 2===e.childElementCount&&"H5"===t.tagName&&tn(t)===Be}},{type:Pe,check:function(e){let t=e.firstElementChild;return 2===e.childElementCount&&"H5"===t.tagName&&tn(t)===Pe}},{type:je,check:function(e){let t=e.firstElementChild;return 2===e.childElementCount&&"H5"===t.tagName&&tn(t)===je}},{type:Re,check:()=>!0}],SPAN:[{type:7,check:e=>0===e.childNodes.length},{type:425,check:()=>!0}],A:[{type:X,check:e=>nn(e,"IMG")||nn(e,"svg")},{type:J,check:()=>!0}],IMG:[V,j]},Wt=Symbol("normal-list"),Gt=Symbol("small-block"),Xt=Symbol("blockcode-item"),qt={[Je]:Gt,[Ye]:Gt,[it]:Gt,[st]:Gt,[at]:Gt,[He]:Xt,526:Xt,[Ze]:Wt,[et]:Wt,[nt]:Wt,[rt]:Wt,[lt]:Wt};function Jt(e,t){if(3===e.nodeType)return 0;if("http://www.w3.org/2000/svg"===e.namespaceURI)return"svg"===e.tagName?4:108;let n=Kt[e.tagName];return n?n(e,t):function(e){let t=+Mt[e];return isNaN(t)?null:t}(function(e){let t=e.getAttribute("role");return(Pt.has(t)?t:e.tagName).toUpperCase()}(e))}function Yt(e,t){if(e===t)return null;let n=rn(e);return Ot(n)?Yt(e.parentElement):It(n)?e:Qt(e,t)}function Qt(e,t){return e===t?null:function(e){let t=rn(e);return kt(t)||Ot(t)}(e)?e:Qt(e.parentElement)}function Zt(t,n){return 3===t.nodeType||e.find("*",t,!0).every((e=>n.has(rn(e))))}function en(t){return 3==t.nodeType?null:dn(t)?t:e.children(t).map((e=>en(e))).flat()}function tn(e){switch(e.nextElementSibling.tagName){case"UL":return je;case"OL":return nn(e,"A")?Be:Pe}return Re}function nn(t,n){let r=t.firstElementChild;return 1===t.childElementCount&&!e.siblingNodes(r,!1,!0).length&&r.tagName===n}function rn(e,t=e.parentElement){if(3===e.nodeType)return 0;if(1!==e.nodeType)return null;let n=e[Ft];return void 0===n&&ln(e,n=Jt(e,t)),n}function ln(e,t){return Reflect.defineProperty(e,Ft,{value:t,enumerable:!1,configurable:!0}),e}function on(e,t){let n=sn(e);return!!n&&n.has(t)}function sn(e){if("number"==typeof e)return bt[e];let t=rn(e),n=xt[t];return n?new Set(Ht(e,n)):bt[t]||""}function an(t){let n=e.clone(t,!0,!0,!0),r=e.find("*",t);return e.find("*",n).forEach(((e,t)=>ln(e,rn(r[t])))),ln(n,rn(t))}function un(t){return fn(t)?[t]:e.contents(t).map((e=>1===e.nodeType?un(e):e)).flat()}function cn(e){return Ct(rn(e))}function fn(e){return Ot(rn(e))}function dn(e){return It(rn(e))||0===e.childElementCount&&e.innerText&&e.innerText.trim()}function pn(e){return Nt(rn(e))}function hn(e){return St(rn(e))}function mn(e){return $t(rn(e))}function gn(e){let t=rn(e);return t>=Ke&&t<=Xe}function _n(e){return Bt.has(rn(e))}function wn(t,n){return n?jt.set(t,n)&&null:(n=jt.get(t)||jt.set(t,new e.Table(t)).get(t)).checkCols()}function vn(t){let n=en(t);return n?e.isArray(n)?n:[n]:[]}function yn(e,t){return fn(e)?Yt(e.parentElement,t):Qt(e.parentElement,t)}function bn(t){let n=e.attr(t,"role");return n?+n.substring(1):t.parentElement?e.parentsUntil(t,"section[role=s5]").length+6:6}function xn(t,n){let r=(n+=bn(t))<6?`s${n}`:null;if(0===n)return!1;Reflect.deleteProperty(e.attr(t,"role",r),Ft)}function En(e,t){let n=qt[rn(e)];if(void 0===n)return function(e,t){let n=rn(e);for(const e of t)if(n!==rn(e))return e;return null}(e,t);for(const e of t)if(n!==qt[rn(e)])return e;return null}function Tn(e,t){let n=Vt[e.tagName];return n?n.some((n=>function(e,t,n){return"number"==typeof n?t.has(n)&&!!ln(e,n):t.has(n.type)&&n.check(e)&&!!ln(e,n.type)}(e,t,n))):t.has(rn(e))}
//! $ID: common.js 2019.09.07 Cooljed.Libs $
const Cn=new $(";",new A,new k),Nn=new R;class Sn extends Set{constructor(e){super(),this._cls=e,this._n2=null,this._p2=null}add(t){return super.add(e.addClass(t,this._cls)),t}delete(t){return super.delete(e.removeClass(t,this._cls)),t===this._n2&&(this._n2=null),t===this._p2&&(this._p2=null),t}clear(){return this.removes(this)}first(){for(const e of this)return e}next(e){let t=[...this],n=this._next(t,e),r=this._n2;return this._n2=this._next(t,n||r||t[0]),n||r||t[0]}prev(e){let t=[...this],n=this._prev(t,e),r=this._p2;return this._p2=this._prev(t,n||r||t[t.length-1]),n||r||t[t.length-1]}pushes(e){return e.forEach((e=>this.add(e))),this}removes(e){return e.forEach((e=>this.delete(e))),this}_next(e,t){let n=e.indexOf(t);return n<0?null:e[n+1]}_prev(e,t){let n=e.indexOf(t);return n<0?null:e[n-1]}}class $n extends Map{add(e,t){super.set(t,e)}top(){let e;for(e of this);return e?e[1]:null}}class An{constructor(e=""){this._fix=e}get(e){return window.localStorage.getItem(this._fix+e)}set(e,t){return window.localStorage.setItem(this._fix+e,t),this}del(e){window.localStorage.removeItem(this._fix+e)}has(e){return!!window.localStorage.getItem(this._fix+e)}clear(){window.localStorage.clear()}keys(){let e=Object.keys(window.localStorage),t=this._fix.length;return e.filter((e=>e.startsWith(this._fix))).map((e=>e.substring(t)))}}class kn{constructor(e,t){this._max=e,this._buf=[],this._idx=-1,this._hist=t}push(...e){if(!e.length)return;return this._buf.length=++this._idx,this._buf.push(e)-this._max>0&&this._shift()}pop(){let e=this._buf.pop();this._idx--,e.slice().reverse().forEach((e=>e.undo()))}undo(){if(this._idx<0)return zn("[undo] overflow.");let e=this._buf[this._idx];this._confirm(e)&&(this._idx--,e.slice().reverse().forEach((e=>e.undo())))}redo(){if(this._idx>=this._buf.length-1)return zn("[redo] overflow.");this._buf[++this._idx].forEach((e=>e.redo()))}clear(){this._buf.length=0,this._idx=-1,this._hist.clear()}canUndo(){return this._idx>=0}canRedo(){return this._idx<this._buf.length-1}_confirm(e){let t=!0;for(const n of e)if(n.warn&&(t=window.confirm(n.warn()),!t))break;return t}_shift(){let e=this._buf.shift();this._idx--,e.forEach((e=>e.count&&this._hist.prune(e.count)))}}class On{constructor(e,t){this._data=e,this._size=t,this._idx=0}next(){let e=this.pages()-1;return this._idx<e?this.page(this._idx+1):null}prev(){return this._idx>0?this.page(this._idx-1):null}first(){return this.page(0)}last(){return this.page(this.pages()-1)}page(e){let t=e*this._size;return this._idx=e,this._data.slice(t,t+this._size)}index(e){if(void 0===e)return this._idx;this._idx=e}reset(e){return this._idx=0,this._data=e,this}pages(){return Math.ceil(this._data.length/this._size)}}class Rn{constructor(e){this._tpl=e,this._pool=[]}page(e,t){return this._pool[e]||this._render(e,this._clone(this._tpl),t)}reset(){return this._pool.length=0,this}_render(e,t,n){return this._pool[e]=S.update(t,n)}_clone(t){return S.clone(t,e.clone(t,!0,!0,!0))}}class In extends Set{constructor(e){super(),this._make=e}pick(...e){return this._pick()||this._make(...e)}_pick(){let e;for(e of this)break;return void 0!==e&&this.delete(e),e}}const Ln=new In(m);function zn(e,t){window.console.warn(e,t||"")}function Un(t,n,r,l){let o=t.tagName.toLowerCase(),i=`<${o}${function(e,t,n){let r="",l=new Map([["on"],["by"],["to"]]);for(let t=0;t<e.length;t++){let n=e[t];l.has(n.name)?l.set(n.name,n.value):r+=` ${n.name}`+(""===n.value?"":`="${Dn(n.value)}"`)}return r+function(e,t,n){let r=[];n=`${n}${t}`;for(const[l,o]of e)o&&r.push(`${l}="${Hn(o,t,n)}"`);return r.length?`\n${n}`+r.join(`\n${n}`):""}(l,t,n)}(t.attributes,r,l)}`,s="";if(function(e){return Et(rn(e))}(t))return i+" />";i+=">";for(const e of t.childNodes)s+=Bn(e,n,r,l+r);return i+s+function(t,n){return 3===t.nodeType||fn(t)||dn(t)||function(t){let n=e.contents(t,-1,!1,!0);return 3===n.nodeType||fn(n)}(t)?"":"\n"+n}(t,l)+`</${o}>`}function Dn(e){return e.replace(/"/g,"&quot;")}function Hn(e,t,n){return Cn.reset(),[...Cn.split(e)].map((e=>Dn(e.trim()))).join(`;\n${n}${t}`)}function Mn(e){let t=Ln.pick();return new Promise((n=>{t.onmessage=e=>{if(t.onmessage=null,Ln.add(t),e.data.error)throw e.data.error;n(e.data.result)},t.postMessage(`return ${e}`)}))}function Fn(t,n=1){let r=e.prevNodes(t,!1,!0),l=0;for(;l<r.length;l++){let e=r[l];if(--n<0||pn(e))break}return r[l-1]||null}function jn(t,n=1){let r=e.nextNodes(t,!1,!0),l=0;for(;l<r.length;l++){let e=r[l];if(--n<0||hn(e))break}return r[l-1]||null}function Pn(t,n){let r=n.parentNode,l=n.previousSibling;return e.replace(t,n),l?e.after(l,t):e.prepend(r,t)}function Bn(t,n,r,l=""){let o=t.nodeType,i=(a=l,3===(s=t).nodeType||1===s.nodeType&&fn(s)?"":"\n"+a);var s,a;return 1===o?i+(function(t){let n=t.nodeName;return"CODE"==n||"PRE"==n?e.prop(t,"outerHTML"):""}(t)||Un(t,n,r,l)):3===o?t.textContent.trim()&&e.html(n?function(e){let t=e.textContent.replace(/\s+/g," ");return e.nextSibling||(t=t.trimEnd()),e.previousSibling||(t=t.trimStart()),t}(t):t.textContent):8===o?i+`\x3c!--${t.data}--\x3e`:t.outerHTML||t+""}function Kn(e){return Nn.parse(e).map((e=>{return t=e.type,n=e.text,t?`<${t}>${n}</${t}>`:n;var t,n})).join("")}function Vn(t){let n=[];for(const e of t.childNodes){let t=e.nodeType;1===t?n.push(Vn(e)):3!==t&&8!==t||n.push(e)}return n.length&&e.fill(t,n),function(e){let t=rn(e);return Ot(t)||"CODE"===e.parentElement.tagName&&zt(t)}(t)?t:t.textContent}
//! $ID: coding.js 2020.02.07 Cooljed.Libs $
const Wn=new Set("ೠൕ൘൙൚൛൜൝൞ൟൠ൧൨൩൪൫൬൭൮൯൰൱൲൳൴൵൶൷൸൹ൺൻർൽൾൿᳩᳪᳫ⁇※‱℃".split(""));function Gn(e){let t=e.indexOf("\t");return t<0?[e]:[e.substring(0,t),e.substring(t+1)||!0]}function Xn(e,t,n){let r=e.innerText||e.textContent,l=r.lastIndexOf(n,t-1);return l<0?[r.substring(0,t)]:[r.substring(l+1,t),!0]}function qn(e,t,n){let r=e.innerText||e.textContent,l=r.indexOf(n,t);return l<0?[r]:[r.substring(t,l),!0]}function Jn(e,t,n){let r=[];for(;e;){let[l,o]=Xn(e,t,n);if(r.push(l),t=1/0,o)break;e=e.previousSibling}return[r.reverse().join(""),!!e]}function Yn(e,t,n){let r=[];for(;e;){let[l,o]=qn(e,t,n);if(r.push(l),t=0,o)break;e=e.nextSibling}return[r.join(""),!!e]}function Qn(e,t){let n=0;for(;n<t&&/[ \t]/.test(e[n]);n++);return n}function Zn(e){let t=0;for(const n of e)t+="\t"!==n?n.codePointAt(0)>=8527||Wn.has(n)?2:1:8-t%8;return t}function er(t,n,r){let l=t.startContainer,o=t.startOffset;return l===r&&(l=e.contents(l,o)),n?Jn(l,o,"\n")[0]:!1===n?Yn(l,o,"\n")[0]:Jn(l,o,"\n")[0]+Yn(l,o,"\n")[0]}function tr(t,n,r){return r>0&&(t=t.map((e=>function(e,t=4){let n=[],r="",l=e;for(;l;)[r,l]=Gn(l),l&&(r+=" ".repeat(t-Zn(r)%t),!0===l&&(l=null)),n.push(r);return n.join("")}(e,r)))),t=t.join("\n"),n?new I(t,n).effect():[{text:e.html(t)}]}
//! $ID: create.js 2019.09.07 Cooljed.Libs $
const nr={[H]:"audio",[M]:"video",3:"picture",4:"svg",5:"ruby",[F]:"meter",7:"span\\space",[j]:"img",9:"br",10:"wbr",108:null,[P]:"track",[B]:"source",[K]:"source",[V]:"img",104:"rt",[G]:"rp",[X]:"a",[q]:"i\\explain",[J]:"a",[oe]:"strong",[ie]:"em",[Y]:"q",[Q]:"abbr",[se]:"cite",[re]:"time",[ae]:"small",[Z]:"del",[ee]:"ins",[ue]:"sub",[ce]:"sup",[fe]:"mark",[le]:"code",[de]:"code\\orz",[te]:"dfn",[pe]:"samp",[he]:"kbd",[me]:"s",[ge]:"u",[_e]:"var",[ne]:"bdo",[we]:"p",[ve]:"p\\note",[ye]:"p\\tips",[xe]:"address",[be]:"pre",[Ee]:"h1",[Te]:"h2",[Ce]:"h3",[Ne]:"h4",[Se]:"h5",[$e]:"h6",[Ae]:"summary",[ke]:"figcaption",[Oe]:"caption",[Re]:"li",[Ie]:"dt",[Le]:"dd",[De]:"tr",[ze]:"th",[Ue]:"td",416:"tbody",415:"thead",417:"tfoot",[He]:"li",[Me]:"li",[Fe]:"h5",[je]:"li",[Pe]:"li",[Be]:"li",424:"ol\\cascade",425:"span",500:"hgroup",[qe]:"header\\abstract",507:"nav\\toc",508:"nav\\reference",509:"aside\\seealso",[Je]:"header",[Ye]:"footer",512:"article",[Ke]:"section\\s1",[Ve]:"section\\s2",[We]:"section\\s3",[Ge]:"section\\s4",[Xe]:"section\\s5",[Qe]:"section",[Ze]:"ul",[et]:"ol",[tt]:"ol\\codelist",[nt]:"ul\\ulx",[rt]:"ol\\olx",[lt]:"ol\\cascade",[ot]:"dl",521:"table",522:"figure",[it]:"blockquote",[st]:"aside",[at]:"details",526:"pre\\codeblock",[ut]:"hr",528:"div\\blank",[ct]:"b",[ft]:"i"},rr={[H]:function(){return e.elem("audio","Sorry, your browser doesn't support embedded audios.")},[M]:function(){return e.elem("video","Sorry, your browser doesn't support embedded videos.")},4:function(){return e.svg()},108:function(){return e.fragment("","svg")}},lr={4:function(e,t,n,r){return Sr(null,br(e,t,r),!0)},108:function(e,t,n,r){return Sr(null,br(e,t,r),!0)},5:function(t,n,{rt:r,rpl:l,rpr:o},i){return e.append(n,function(t,n,r,l){let o=[e.Text(l)];n&&o.push(Ar(G,t||_.rpLeft),Ar(W,n),Ar(G,r||_.rpRight));return o}(l,r,o,vr(i))),Sr(null,n,!0)},[le]:function(t,n,r,l){return l&&(l="string"==typeof l?e.fragment(l,!1):function(t){let n=sn(le);return e.isArray(t)?t.every((e=>Zt(e,n))):Zt(t,n)}(l)?l:vr(l),e.append(n,l)),Sr(null,n,!0)},[De]:function(t,n,{tsec:r},l){let o=e(n.cells);return 0===o.length&&(o=e(function(t,n){let r=wn((n=n||t.parentElement).parentElement);return e.append(t,r.newTR("THEAD"===n.tagName).children)}(n,r))),l&&l.nodeType?(o.append(vn(l).map((t=>e.contents(t)))),Sr(null,o,!0)):Sr(null,o)},416:function(e,t,n,r){let{th0:l,head:o,foot:i}=n,s=wn(t.parentElement||n.table),[a,u]=mr(e,s,t,r);return l&&s.rows()>0&&s.insertColumn(s.newColumn(!0),0),o&&function(e,t,n){fr(e,dr(e,t,!0),n)}(s,o,s.head()),i&&function(e,t,n){fr(e,dr(e,t),n)}(s,i,s.foot()),Er(n,"th0","head","foot"),Sr(null,a,u)},415:function(e,t,n,r){let[l,o]=mr(e,wn(t.parentElement||n.table),t,r,!0);return Sr(null,l,o)},417:function(e,t,n,r){let[l,o]=mr(e,wn(t.parentElement||n.table),t,r);return Sr(null,l,o)},[je]:function(t,n,{h5:r},l){if(!l)return Sr(null,l,!0);let o=e.empty(n),[i,s]=pr(t,n,l,(()=>Ar(Ze)));return Sr(ur(n,Se,r||o),i,s)},[Pe]:function(t,n,{h5:r},l){let o=e.empty(n),[i,s]=pr(t,n,l,(()=>Ar(et)));return Sr(ur(n,Se,r||o),i,s)},[Be]:function(e,t,{h5a:n},r){let[l,o]=pr(e,t,r,(()=>Ar(et)));return Sr(n&&ur(t,Fe,n),l,o)},424:function(t,n,r,l){let o=e.children(l,"section");return Sr(null,e.append(n,wr(o)),!0)},425:function(t,n,{explain:r},l){let[o,i]=pr(t,n,l,(()=>Ar(j)));return"string"==typeof r&&(r=function(t,n){let r=n;e.isArray(n)||(r=[n]);if(r.some((e=>!on(t,rn(e)))))return null;return e.append(t,n)}(n,Rr(q,null,r))),Sr(r,o,i)},[X]:function(e,t,n,r){let[l,o]=pr(e,t,r,(()=>Ar(j)));return Sr(null,l,o)},500:function(e,t,n,r){let{h1:l}=n,[o,i]=pr(e,t,r,(()=>Ar(Ce)));return Er(n,"h1"),Sr(l&&ur(t,Ee,l),o,i)},507:function(e,t,{h4:n},r){let[l,o]=pr(e,t,r,(()=>Ar(424)));return Sr(n&&ur(t,Ne,n),l,o)},508:function(e,t,{h4:n},r){let[l,o]=pr(e,t,r,(()=>Ar(et)));return Sr(n&&ur(t,Ne,n),l,o)},509:function(e,t,{h4:n},r){let[l,o]=pr(e,t,r,(()=>Ar(Ze)));return Sr(n&&ur(t,Ne,n),l,o)},512:function(e,t,n,r){let{header:l}=n,[o]=pr(e,t,r,_r(e,t,r));return Er(n,"header"),Sr(l&&cr(t,l),o,!0)},[tt]:function(e,t,n,r){let[l,o]=pr(e,t,r,(()=>Ar(He)));return Sr(null,l,o)},526:function(e,t,n,r){let[l,o]=pr(e,t,r,(()=>Ar(le)));return Sr(null,l,o)},[ot]:function(e,t,n,r){let{dt:l}=n,[o,i]=pr(e,t,r,(()=>Ar(Le)));return Er(n,"dt"),Sr(l&&hr(o||e,t,Ar(Ie,l)),o,i)},521:function(e,t,n,r){let l,o=wn(t),i=[];return function(e,t,n){if(!t)return e.caption(null);n.push(e.caption(t))}(o,n.caption,i),function(e,t){null===t&&e.head(null);t&&e.head(!0)}(o,n.head),function(e,t){null===t&&e.foot(null);t&&e.foot(!0)}(o,n.foot),r&&"TBODY"===r.tagName&&(l=o.bodies(0,r)),Er(n,"caption"),Sr(i,l||o.body(!0),!!l)},522:function(e,t,n,r){let{figcaption:l}=n,[o,i]=pr(e,t,r,(()=>Ar(425)));return Er(n,"figcaption"),Sr(l&&ur(t,ke,l),o,i)},[at]:function(e,t,n,r){let{summary:l}=n,[o,i]=pr(e,t,r,(()=>Ar(we)));return Er(n,"summary"),Sr(l&&ur(t,Ae,l),o,i)},3:function(t,n,r,l){return l&&("IMG"===l.tagName&&ln(l,V),on(n,rn(l))&&e.append(n,l)),Sr(null,n,!0)}};[H,M].forEach((function(t){lr[t]=function(t,n,r,l){return l&&on(n,rn(l))&&e.append(n,l),Sr(null,n,!0)}})),[[He,le],[Me,J],[Fe,J]].forEach((function(e){lr[e[0]]=function(t,n,r,l){if(n.childElementCount>0)return Sr(null,n.firstElementChild);let[o,i]=pr(null,n,l,(()=>Ar(e[1])));return Sr(null,o,i)}})),[qe,Je,Ye,it,st].forEach((function(e){lr[e]=function(e,t,n,r){let{h4:l}=n,[o,i]=pr(e,t,r,(()=>Ar(we)));return Er(n,"h4"),Sr(l&&ur(t,Ne,l),o,i)}})),[Ze,et,nt,rt,lt].forEach((function(e){lr[e]=function(e,t,n,r){let[l,o]=pr(e,t,r,(()=>Ar(Re)));return Sr(null,l,o)}})),[Ke,Ve,We,Ge,Xe,Qe].forEach((function(e){lr[e]=function(e,t,n,r){let{h2:l,header:o}=n,i=[l&&ur(t,Te,l),o&&cr(t,o)],[s]=pr(e,t,r,_r(e,t,r));return Er(n,"h2","header"),Sr(i.filter((e=>e)),s,!0)}})),[F,q,J,Y,Q,Z,ee,te,ne,re,oe,ie,se,ae,ue,ce,fe,de,pe,he,me,ge,_e,ct,ft,we,ve,ye,be,xe,Ee,Te,Ce,Ne,Se,$e,Ae,ke,Oe,Re,Ie,Le,ze,Ue].forEach((function(t){lr[t]=function(t,n,r,l){return l=e.isArray(l)?e.map(l,(e=>xr(n,e))).flat():xr(n,l),hr(t,n,l),Sr(null,l,!0)}}));const or={4:function(t,n){return e.attribute(t,n)},[re]:function(t,{date:n,time:r}){return e.attr(t,"datetime",yr(n,r))},[Z]:function(t,{date:n,time:r,cite:l}){return e.attribute(t,"datetime cite",[yr(n,r),l||null])},[ee]:function(t,{date:n,time:r,cite:l}){return e.attribute(t,"datetime cite",[yr(n,r),l||null])},7:function(t,{width:n}){return n&&e.css(t,"width",n),t},[ut]:function(t,{role:n,thick:r,length:l,space:o}){return n&&e.attr(t,"role",n),e.cssSets(t,"borderWidth width height",[r,l,o])},521:function(t,{cols:n,border:r}){let l=new e.Table(t,n);return r&&e.attr(t,"border",r),wn(t,l)||t}};[[H,["src","autoplay","loop","controls"]],[M,["src","autoplay","loop","controls","poster","width","height"]],[j,["src","alt","width","height"]],[V,["src","alt","width","height"]],[B,["src","type"]],[K,["srcset","media"]],[P,["kind","src","srclang","label","default"]],[F,["value","max","min","high","low","optimum"]],[Re,["value"]],[He,["value"]],[Me,["value"]],[je,["value"]],[Pe,["value"]],[Be,["value"]],[it,["cite"]],[at,["open"]],[J,["href","target","title"]],[X,["href","target","title"]],[Y,["cite"]],[Q,["title"]],[te,["title"]],[ne,["dir"]],[tt,["lang:-lang","start"]],[le,["lang:-lang"]],[q,["fix:-pba"]]].forEach((function(t){or[t[0]]=(n,r)=>e.attribute(n,function(e,t){let n={};for(const r of t){let[t,l]=r.split(":");void 0!==e[t]&&(n[l||t]=e[t])}return n}(r,t[1]))}));const ir={[Y]:function(t,n={}){return n.cite=e.attr(t,"cite"),[n,e.Text(t)]},[Q]:Tr,[Z]:Cr,[ee]:Cr,[te]:Tr,[ne]:function(t,n={}){return n.dir=e.attr(t,"dir"),[n,e.Text(t)]},[re]:Cr};[J,le,oe,ie,se,ae,ue,ce,fe,de,pe,he,me,ge,_e].forEach((function(t){ir[t]=(t,n)=>[n||{},e.Text(t)]}));const sr={[it]:Nr,[st]:Nr,[at]:function(t,n={}){let r=e.get("summary",t),l=e.children(t);return r&&(n.h4=r.textContent,l.splice(l.indexOf(r),1)),n.open=!0,[n,l.map(an)]}};[Ze,et,nt,rt,lt,ot].forEach((function(t){sr[t]=function(t,n={}){return n.open=!0,[n,e.children(t).map(an)]}}));const ar={};function ur(t,n,r){let l=t.firstElementChild;return l===r?l:(l&&rn(l)===n||(l=e.prepend(t,Ar(n))),r.nodeType&&rn(r)===n?e.replace(l,r):(e.fill(l,r.nodeType?e.contents(r):r),l))}function cr(t,n){let r=e.get(">header",t);if(r)return r===n?r:e.replace(r,n);let l=e.get(">h2",t);return l?e.after(l,n):e.prepend(t,n)}function fr(e,t,n){return t.forEach((t=>e.insertTR(t,null,n))),n}function dr(t,n,r){let l=[];for(const o of n)l.push(t.newTR(r)),e("th,td",l[l.length-1]).fill(o);return l}function pr(e,t,n,r){if(!n)return[null,!0];let l=n.nodeType?rn(n):0;return on(t,l)&&!Tt(l)?[hr(e,t,n),!0]:[hr(e,t,r()),!1]}function hr(t,n,r){return t?e.before(t,r):e.append(n,r)}function mr(e,t,n,r,l){if(!r)return[null,!0];let o=e?t.trIndex(e,n):null;return"TR"!==r.tagName||!function(e,t){return function(e){return[...e.cells].reduce(((e,t)=>e+t.colSpan),0)}(e)===t.cols()}(r,t)||l&&![...r.cells].every((e=>"TH"===e.tagName))?[t.insertTR(t.newTR(l),o,n),!1]:[t.insertTR(r,o,n),!0]}function gr(t,n,r){if("SECTION"!==r.tagName)throw new Error(`<${r.tagName}> not a SECTION`);hr(t,n,function(t,n){return e.find("section",t,!0).forEach((e=>xn(e,n))),t}(r,("ARTICLE"===n.tagName?0:bn(n))-bn(r)+1))}function _r(e,t,n){switch(Dt(t)){case 0:case 1:return()=>Rr(we,null,n);case 2:return()=>gr(e,t,n)}return null}function wr(t){return t.map((t=>function(t){let n=e.get(">h2",t),r=e.children(t,"section");n||function(e,t){t&&window.console.info(t);throw new Error(e)}("<H2> is missed...!!",t);if(!r.length)return l=n,kr(Ar(Me),{href:l.id?`#${l.id}`:null},l.innerText);var l;let o=function(e){let t=kr(Ar(J),{href:e.id?`#${e.id}`:null},e.innerText);return kr(Ar(Be),{h5a:[t]},Ar(et))}(n);return e.append(o.lastElementChild,wr(r)),o}(t)))}function vr(t){return e.isArray(t)?t.map((e=>e.textContent)).join(""):t.nodeType?t.textContent:t+""}function yr(e,t){return t&&(e=e?`${e} ${t}`:`${t}`),e||null}function br(t,n,r){return"string"==typeof r&&(r=function(t){return e.find("*",t).forEach((e=>ln(e,108))),t}(e.fragment(r,"svg"))),hr(t,n,r)}function xr(t,n){return!n||n.nodeType>1?n||null:"string"==typeof n?e.Text(n,!0):Ut(rn(t))?e.Text(n):un(n).map((n=>on(t,rn(n))?n:e.Text(n)))}function Er(e,...t){t.forEach((t=>delete e[t]))}function Tr(t,n={}){return n.title=e.attr(t,"title"),[n,e.Text(t)]}function Cr(t,n={}){let r=e.attr(t,"datetime");return r&&([n.date,n.time]=r.split(/\s+/)),n.cite=e.attr(t,"cite"),n.datetime=r,[n,e.Text(t)]}function Nr(t,n={}){let r=e.get("h4",t),l=e.children(t);return r&&(n.h4=r.textContent,n.summary=r.textContent,l.splice(l.indexOf(r),1)),n.open=!0,[n,e(l).clone()]}function Sr(e,t,n=!1){return{head:e||null,body:t,end:n}}function $r(t,n){return t?(e.isArray(t)?t:[t]).concat(n):e.isArray(n)?n:[n]}function Ar(t,n){let r=rr[t],l=r?r():function(t,n){let r=e.elem(t);return n&&r.setAttribute("role",n)||r}(...nr[t].split("\\"));return n&&e.append(l,n),ln(l,t)}function kr(e,t,n,r){let l=rn(e),o=or[l];return o&&(e=o(e,t)),lr[l]&&function(e,t,n,r){if(r)return n.forEach((n=>Or(null,e,t,n)));Or(null,e,t,n)}(e,t,n,r),e}function Or(t,n,r,l){let o=rn(n),i=lr[o](t,n,r,l);return i.end?$r(i.head,i.body):e.isArray(i.body)?$r(i.head,i.body.map(((t,n)=>kr(t,r,function(t,n){return e.isArray(t)?t[n]:t}(l,n))))):$r(i.head,kr(i.body,r,l))}function Rr(e,t,n,r){if("string"==typeof e&&(e=Mt[e.toUpperCase()]),null==e)throw new Error("invalid target name.");return kr(Ar(e),t||{},n||"",r)}function Ir(e){let t=rn(e);return sr[t]?_.convBlocks:ar[t]?_.convLines:ir[t]&&!function(e){let t=rn(e.parentElement);return 526===t||t===He}(e)?_.convInlines:null}function Lr(e){let t=rn(e),n=ir[t]||ar[t]||sr[t];if(!n)throw new Error(`[${e}] convert is not supported.`);return n(e)}[we,ve,ye,be,xe].forEach((function(e){ar[e]=(e,t={})=>[(t.open=!0,t),an(e)]})),i(g,"New",(function(e){let t=Mt[e.toUpperCase()];if(null==t)throw new Error("invalid target name.");return(e,n,r)=>kr(Ar(t),n||{},e.data,r)}),1),i(g,"New2",(function(e){let t=Mt[e.toUpperCase()];if(null==t)throw new Error("invalid target name.");return(e,n)=>e.data.map((e=>kr(Ar(t),n||{},e)))}),1);
//! $ID: templates.js 2020.05.09 Cooljed.Config $
const zr={0:"option:text",[H]:"option:audio",[M]:"option:video",3:"option:picture",4:"option:svg",5:"option:ruby",[F]:"option:meter",7:"option:space",[j]:"option:img",9:"option:br",10:"option:wbr",[P]:"option:track",[B]:"option:source1",[K]:"option:source2",[V]:"option:pimg",[q]:"option:explain",108:"option:svgitem",[J]:"option:a",[Y]:"option:q",[Q]:"option:abbr",[Z]:"option:del",[ee]:"option:ins",[te]:"option:dfn",[ne]:"option:bdo",[re]:"option:times",[le]:"option:code",[oe]:"option:strong",[ie]:"option:em",[se]:"option:cite",[ae]:"option:small",[ue]:"option:sub",[ce]:"option:sup",[fe]:"option:mark",[de]:"option:orz",[pe]:"option:samp",[he]:"option:kbd",[me]:"option:s",[ge]:"option:u",[_e]:"option:var",[we]:"option:p",[ve]:"option:note",[ye]:"option:tips",[be]:"option:pre",[xe]:"option:address",[Ee]:"option:h1",[Te]:"option:h2",[Ce]:"option:h3",[Ne]:"option:h4",[Se]:"option:h5",[$e]:"option:h6",[Ae]:"option:summary",[ke]:"option:figcaption",[Oe]:"option:caption",[Re]:"option:li",[Ie]:"option:dt",[Le]:"option:dd",[De]:"option:tr",415:"option:thead",416:"option:tbody",417:"option:tfoot",[He]:"option:codeli",[Me]:"option:ali",[Fe]:"option:ah5",[je]:"option:xh5li",[Pe]:"option:xolh5li",[Be]:"option:xolah5li",425:"option:figconbox",500:"option:hgroup",512:"option:article",[Ke]:"option:s1",[Ve]:"option:s2",[We]:"option:s3",[Ge]:"option:s4",[Xe]:"option:s5",[qe]:"option:abstract",509:"option:seealso",508:"option:reference",[Je]:"option:header",[Ye]:"option:footer",[Qe]:"option:section",[Ze]:"option:ul",[et]:"option:ol",[tt]:"option:codelist",[nt]:"option:ulx",[rt]:"option:olx",[lt]:"option:cascade",[ot]:"option:dl",521:"option:table",522:"option:figure",[it]:"option:blockquote",[st]:"option:aside",[at]:"option:details",526:"option:codeblock",[ut]:"option:hr",528:"option:blank"},Ur={[H]:"property:audio",[M]:"property:video",3:"property:picture",[j]:"property:img",[V]:"property:img",4:"property:svg",5:"property:ruby",[re]:"property:times",[F]:"property:meter",7:"property:space",[J]:"property:a",[X]:"property:a",[Y]:"property:q",[Q]:"property:abbr",[Z]:"property:del",[ee]:"property:ins",[le]:"property:code",[te]:"property:dfn",[ne]:"property:bdo",[it]:"property:blockquote",[at]:"property:details",[tt]:"property:codelist",[et]:"property:ol",[rt]:"property:olx",[Re]:"property:li",[He]:"property:li",[Me]:"property:li",[je]:"property:li",[Pe]:"property:li",[Be]:"property:li",521:"property:table",[ut]:"property:hr",528:"property:blank",[q]:"property:explain",[Ee]:"property:h1",[Te]:"property:h2",[Ce]:"property:h3",[Ne]:"property:h4",[Se]:"property:h5",[$e]:"property:h6"},Dr=new Set([W,G,ze,Ue,V,10,-10]);
//! $ID: shedit.js 2021.04.08 Cooljed.Libs $
const Hr=new e.Fx.History,Mr=new An(`${_.nameEditor}_${_.scriptList}`),Fr=new kn(w.shEdits,Hr),jr=Symbol("sh:dpage"),Pr=Symbol("sh:pager");let Br=null,Kr=null,Vr=!1;class Wr{constructor(t){this.$els=e(t),this.count=null,this.redo()}undo(){this.count>0&&Hr.back(this.count)}redo(){let e=Hr.size();this.$els.remove(),this.count=Hr.size()-e}}class Gr{constructor(e){this._sid=e,this._old=Mr.get(e),this.redo()}undo(){Mr.set(this._sid,this._old)}redo(){Mr.del(this._sid)}}class Xr{constructor(e,t){let n=e[jr];this._idx=n.index();let r=Yr(n[t]()),l=n.index();this._nav=e,this._new=e[Pr].page(l,r),this._pgn=l+1,this._pgs=n.pages(),this.count=null,this.redo()}undo(){this.count>0&&Hr.back(this.count),this._nav[jr].index(this._idx)}redo(){let e=Hr.size();Qr(this._nav,"page",this._new,"state",this._pgn,this._pgs),this.count=Hr.size()-e}}function qr(...t){e.trigger(Kr,"state",!0),Fr.push(...t.filter((e=>e)))}function Jr(e){let t=Mr.get(e);return t?JSON.parse(t):null}function Yr(t){return(t=e.map(t,Jr)).edit=Vr,t.cmax=w.shCodelen,t}function Qr(t,n,r,l,o,i){var s,a;e.trigger(t,n,r),e.trigger(t,l,[[o,i],(s=o,a=i,a<=1?[!0,!0,!0,!0]:[1===s,1===s,s===a,s===a])])}function Zr(e,t){let n=e.index();return t.page(n,Yr(e.page(n)))}function el(e,t=0){let n=Date.now()+t;return e.has(n)?el(e,parseInt(240*Math.random()*3600*1e3)):n}function tl(e){if(!e||function(e){return Mr.keys().some((t=>Jr(t).code===e))}(e))return;let t=el(Mr),n={shid:t,code:e,time:Date.now()};Mr.set(t,JSON.stringify(n))}const nl={spinit(e){Br=e.data},__spinit:1,shUndo:()=>(Fr.undo(),!Fr.canUndo()),shRedo:()=>(Fr.redo(),!Fr.canRedo()),shinit(e,t,n,r,l){Kr=e.data,r[jr]=new On(null,w.shListTop),r[Pr]=new Rn(t),l[jr]=new On(null,w.shListAll),l[Pr]=new Rn(n)},__shinit:1,delsh(e,t){Vr&&qr(new Wr(e.data),new Gr(t))},__delsh:1,topsh(e){let t=Jr(e.data);return t&&(t.top=!0,Mr.set(e.data,JSON.stringify(t))),t&&e.data},__topsh:1,untop(e){let t=Jr(e.data);return t&&(t.top=!1,Mr.set(e.data,JSON.stringify(t))),t&&e.data},__untop:1,shlabel(e,t){let n=Jr(e.data);return n&&(n.name=t,Mr.set(e.data,JSON.stringify(n))),n&&[t,e.data]},__shlabel:1,shpage(e,t){let n=new Xr(e.data,t);Vr&&qr(n)},__shpage:1,shtops(e){let t=e.data,n=t[jr].reset(function(){let e=[];for(const t of Mr.keys()){let n=Jr(t);n&&n.top&&n.code&&e.push({id:n.shid,tm:n.time})}return e.sort(((e,t)=>t.tm-e.tm)).map((e=>e.id))}()),r=Zr(n,t[Pr].reset());Qr(t,"page",r,"state",n.index()+1,n.pages())},__shtops:1,shIndex:e=>(Vr=!0,e.data.map((e=>Zr(e[jr],e[Pr].reset())))),__shIndex:1,shEdin(t){Fr.clear(),e.on(t.data,"nodeok emptied detach",null,Hr),e.on(t.data,"attrdone","nav >b",Hr)},__shEdin:1,shEdok(t){Vr=!1,Fr.clear(),e.off(t.data,"nodeok emptied detach attrdone",!1,Hr)},__shEdok:1,sh2panel(t,n,r,l,o){let i=e.outerHeight(r,!0)+e.outerHeight(l,!0),s=e.outerHeight(o,!0)-e.height(o);return[e.height(r)+t.data,e.height(n)-(i+s+t.data)]},__sh2panel:1,shsearch(e,t){let n=t[jr].reset(function(e){let t=function(...e){return t=>e.some((e=>e.every((e=>t.includes(e)))))}(...e.split(",").map((e=>e.trim().split(/\s+/)))),n=[];for(const e of Mr.keys().reverse()){let r=Jr(e);r&&r.code&&t(r.code)&&n.push({id:r.shid,tm:r.time})}return n.sort(((e,t)=>t.tm-e.tm)).map((e=>e.id))}(e.data)),r=Zr(n,t[Pr].reset());Qr(t,"page",r,"state",n.index()+1,n.pages())},__shsearch:1,shcode(t){e.trigger(Br,"shcode",t.data)},__shcode:1,shsave(e){tl(e.data)},__shsave:1};s(g,"Kit",nl,["spinit","shUndo","shRedo","shinit","delsh","topsh","untop","shlabel","shpage","shtops","shEdin","shEdok","shIndex","sh2panel","shsearch","shcode","shsave"]);
//! $ID: highlight.js 2020.02.07 Cooljed.Libs $
const rl={keyword:"kw",literal:"lit",number:"num",function:"fn",operator:"op",builtin:"bin",datatype:"dt",xmltag:"tag",attribute:"atn",regex:"re",selector:"slr",rgba:"rgb",unit:"un",important:"imp",doctype:"doc",error:"err",comments:null};function ll(e,t){return null==t?e:"string"==t?`<s>${e}</s>`:"comments"==t?`<i>${e}</i>`:`<b role="${rl[t]||"non"}">${e}</b>`}function ol(t,n,r){return e.html(t,ll(n,r),"append"),t}function il(e){return e.map((e=>"string"==typeof e?e:ll(e.text,e.type))).join("")}function sl(e){let t=e[0],n=e[e.length-1];return t.text&&t.text.startsWith("\n")&&(t.text=t.text.substring(1)),n.text&&n.text.endsWith("\n")&&(n.text=n.text.slice(0,-1)),e}function al(t,n){let{text:r,type:l}=t;return e.isArray(r)&&(r=il(r)),[ol(n,r,l)]}function ul(t,n){let{text:r,type:l}=t,o=(e.isArray(r)?il(r):r).split("\n");return[ol(n,o.shift(),l),...o.map((e=>ol(n.cloneNode(),e,l)))]}function cl(e,t,n,r=!0){let l=[],o=Rr(le,{lang:e});for(const i of t)void 0===i.text?(l.push(...cl(i.lang,r?sl(i.data):i.data,n)),o=Rr(le,{lang:e})):(l.push(...n(i,o)),o=l[l.length-1]);return[...new Set(l)].filter((e=>!e.normalize()))}
//! $ID: property.js 2021.06.16 Cooljed.Libs $
const fl=/\s+/g,dl=e([_.rpLeft,_.rpRight]).elem("rp"),pl={[H]:function(t,n,r,l){e.attribute(t,r),void 0!==l&&xl(t,"source",l)},[M]:function(t,n,r,l,o){e.attribute(t,r),void 0!==l&&xl(t,"source",l);void 0!==o&&xl(t,"track",o)},3:function(t,n,r,l){let o=e.get("img",t);void 0!==l&&(e.fill(t,l),e.append(t,o));e.attribute(o,r)},[j]:_l,[V]:_l,4:_l,5:function(t,n,r,l,o,i){let s=e("rp",t),a=e.get("rt",t);void 0!==l&&(e.fill(t,l),a&&e.append(t,[s[0],a,s[1]]));if(void 0===r)return;a?e.fill(a,r):e.append(t,[o,e.elem("rt",r),i])},[F]:_l,7:gl,[J]:_l,[X]:_l,[Z]:_l,[ee]:_l,[le]:function(t,n,r,l){void 0!==r&&e.attr(t,"-lang",function(t,n){let r=t.parentElement.parentElement;if(rn(r)!==tt)return n;return e.attr(r,"-lang")===n?null:n}(t,r));void 0!==l&&e.fill(t,l)},[tt]:function(t,n,r,l){e.attribute(t,r),void 0!==l&&e.fill(t,e(l).elem("li"))},[et]:_l,[rt]:_l,[Re]:_l,[He]:_l,[Me]:_l,[je]:_l,[Pe]:_l,[Be]:_l,521:function(t,n,r,l,o){let i=new e.Table(t);void 0!==r&&e.attr(t,"border",r);void 0!==l&&bl(i,l,0);void 0!==o&&bl(i,o,null)},[ut]:function(t,n,r,l){e.cssSets(t,n,r),e.attr(t,"role",l)},528:gl,[q]:function(t,n,r){e.attr(t,n,r),e.cssSets(t,"top right bottom left",null)}},hl={[H]:function(e,t,n,r){return t.autoplay=n[0],t.loop=n[1],t.controls=n[2],[Tl(t,"",null),r]},[M]:function(e,t,n,[r,l]){return t.autoplay=n[0],t.loop=n[1],t.controls=n[2],[Tl(t,"",null),r,l]},3:function(e,t,n){return[Tl(t,"",null),n]},5:function(t,n,r){let l=e.get("rt",t);return e([n,r]).Text().concat(l?[]:dl.clone())},521:El,[re]:wl,[Z]:wl,[ee]:wl,[le]:yl,[tt]:function(t,n,r,l){let o={"-lang":n,start:r},i=e.attr(t,"-lang")||"";if(Tl(o,"",null),!l&&n===i)return[o];return[o,Sl(t,n)]}},ml={[H]:function(t,n,r,l){let o=l&&e(l);return n.autoplay=r[0],n.loop=r[1],n.controls=r[2],Tl(n,"",void 0),Tl(n,null,void 0),t.map((()=>[n,o?o.clone():void 0]))},[M]:function(t,n,r,[l,o]){let i=l&&e(l),s=o&&e(o);return n.autoplay=r[0],n.loop=r[1],n.controls=r[2],Tl(n,"",void 0),Tl(n,null,void 0),t.map((()=>[n,i?i.clone():void 0,s?s.clone():void 0]))},3:function(t,n,r){let l=r&&e(r);return Tl(n,"",void 0),t.map((()=>[n,l?l.clone():void 0]))},5:function(t,n,r){let l=[void 0,void 0];n&&(l[0]=e.Text(n));r&&(l[1]=e.Text(r));return t.map((t=>l.concat(e.get("rt",t)?[]:dl.clone())))},521:function(e,t,n,r){return e.map((e=>El(e,t,n,r)))},[re]:vl,[Z]:vl,[ee]:vl,[le]:function(e,t){return e.map((e=>yl(e,t)))},[tt]:function(t,n,r){return t.map((t=>function(t,n,r){let l={"-lang":n,start:r},o=e.attr(t,"-lang")||"";if(Tl(l,"",void 0),Tl(l,null,void 0),n===o||null===n)return[l];return[l,Sl(t,n)]}(t,n,r)))}};function gl(t,n,...r){e.cssSets(t,n,r)}function _l(t,n,...r){e.attribute(t,n,r)}function wl(e,t,n,r){return n&&(t=t?`${t} ${n}`:`${n}`),[t||null,r||null]}function vl(e,t,n,r){return n&&(t=t?`${t} ${n}`:`${n}`),Cl(e,[t||void 0,r||void 0])}function yl(t,n){let r=t.textContent;if(""===n)return[null,e.Text(r)];let l=cl(null,tr([r],n),al,!1);return[n,(o=l,o.map((e=>[...e.childNodes])).flat())];var o}function bl(e,t,n){let r=e.hasVth(null==n);t?r||e.insertColumn(t,n):r&&e.removeColumn(null==n?-1:n)}function xl(t,n,r){e.find(n,t).forEach((t=>e.remove(t))),e.append(t,r)}function El(t,n,r,l){let o=new e.Table(t),i=o.hasVth(),s=o.hasVth(!0);return[n,r?i||o.newColumn(!0):null===r?void 0:null,l?s||o.newColumn(!0):null===l?void 0:null]}function Tl(e,t,n){for(const r of Object.keys(e))e[r]===t&&(e[r]=n);return e}function Cl(e,t){return new Array(e.length).fill(t)}function Nl(e,t){let n=e.map((e=>e.hasVth(!!t)));return 1===n.length||1===new Set(n).size?[n[0],!1]:[null,!0]}function Sl(t,n){let r=e.children(t).map((e=>e.textContent));return""===n?e(r).elem("code"):cl(null,tr(r,n),ul)}const $l={vals1:e=>1===e.data.length||1===new Set(e.data).size?e.data[0]||"":null,__vals1:1,vals2:e=>1===e.data.length||1===new Set(e.data).size?[e.data[0],!1]:[null,!0],__vals2:1,tableVth(t){let n=t.data.map((t=>new e.Table(t)));return[Nl(n),Nl(n,!0)]},__tableVth:1,attrVal:(t,n)=>n.split(fl).map((n=>function(t,n){let r=t.map((t=>e.attr(t,n)));return 1===r.length||1===new Set(r).size?r[0]||"":null}(t.data,n))),__attrVal:1,attrBool:(t,n)=>n.split(fl).map((n=>function(t,n){let r=t.map((t=>e.attr(t,n)));return 1===r.length||1===new Set(r).size?[null!==r[0],!1]:[null,!0]}(t.data,n))),__attrBool:1};a(v,"p",$l,Object.keys($l).filter((e=>"_"!==e[0])));
//! $ID: plugins.js 2021.09.23 Cooljed.Plugins $
const Al=Object.create(u),kl=Object.create(c),Ol=new U(y),Rl=new Map,Il=new Map,Ll=new WeakMap;function zl(t,n=b.plugConf){return Ol.json(`${t}/${n}`).then((n=>function(t,n){if(n.style)return e.style({href:`${y}${t}/${n.style}`}).then((e=>Il.set(t,e)&&n));return n}(t,n))).then((e=>function(e,t){if(!t.extend)return t;return import(`${y}${e}/${t.extend}`).then((e=>function(e,t){return e.on=t.On||null,e.by=t.By||null,e}(t,e)))}(t,e))).then((e=>function(e,t){if(!t.root)return null;let n=new z(d(t.on,t.by),new D(e,Ol));return n.config(t.maps).then((()=>Ol.node(`${e}/${t.root}`))).then((e=>n.build(e,t.root)))}(t,e)))}function Ul(t,n=null){if(Rl.has(t))return Promise.resolve(null);let r=`${b.plugRoot}/${t}`,l=e.Element("img",{src:`${y}${r}/${b.plugLogo}`}),o=e.wrap(l,e.Element("button",{title:n}));return zl(r).then((e=>Rl.set(t,o)&&f.templater(t,e)||Ll.set(o,t)&&o))}
//! $ID: cmdline.js 2021.08.08 Cooljed.Libs $
const Dl=/^\(([^]*?)\)$/,Hl=/^\[([\d:,\s]*)\]$/,Ml=/\s*:\s*/,Fl=/^\{(.*)\}$/,jl=/^\/(.*)\/([imsugy]*)$/,Pl=/^(['"`])(.*)\1$/,Bl=new $("|",new A,new O("[","]"),new O("{","}"));let Kl=null,Vl=null;class Wl{constructor(e,t){this._set=e,this._ctx=t}exec(e,t){let n=[...Bl.reset().split(e.trim())],r=n.shift();return to(n,this._set.size>0?this._finds(r,t,[...this._set]):this._find(r,t,this._ctx))}_find(e,t,n){return L.find(e,t,!1,n)}_finds(e,t,n){return n.map((n=>L.find(e,t,!1,n))).flat()}}class Gl{constructor(e){this._set=e}exec(t){return to([...Bl.reset().split(t.trim())],e(this._set))}execOne(t,n){return this._handle(t.trim())(e(n))}_handle(e){return Dl.test(e)?this._exclude(e.match(Dl)[1]):Hl.test(e)?this._number(e.match(Hl)[1]):Fl.test(e)?this._filter(e.match(Fl)[1]):t=>t.filter(e)}_exclude(t){return n=>n.filter((n=>!e.is(n,t)))}_number(e){let t=e.split(Ml);return t.length>1?this._range(t):(t=JSON.parse(`[${e}]`),e=>t.map((t=>e[t])).filter((e=>e)))}_range([e,t]){return e=Math.trunc(e)||0,t=t.trim()?Math.trunc(t):void 0,n=>n.slice(e,t)}_filter(e){let t=new Function("v","i","c",`return ${e};`);return e=>e.filter(t)}}class Xl{constructor(e){this._ctx=e,this._doc=e.ownerDocument}exec(e,t){return e=jl.test(e)?this._regexp(e):no(e),t.map((t=>this._ranges(t,e))).flat()}_ranges(e,t){let n=[],r=0,l=0;for(;[r,l]=this._search(e.textContent,t,r),!(r<0||0===l);)n.push(this._range(e,r,l)),r+=l;return n}_search(e,t,n){if("string"==typeof t)return[e.indexOf(t,n),t.length];let r=e.substring(n),l=r&&r.match(t);return l?[n+l.index,l[0].length]:[-1,0]}_range(e,t,n){let r=this._doc.createRange();return r.setStart(e,t),r.setEnd(e,t+n),r}_regexp(e){let[t,n]=e.match(jl).slice(1);return n&&(n=n.split("").filter((e=>"g"!==e)).join("")),new RegExp(t,n)}}class ql{constructor(e){this._cmds=new Map([["plug-ins",this._plugIns],["plug-del",this._plugDel],["help",this._help],["config",this._config],["replace",this._replace.bind(this)]]),this._eset=e}exec(e){let[t,n]=this._cmdArgs(e),r=this._cmds.get(t);if(!t)return E.commandInvalid;try{return r(...n)||""}catch(e){return`[${e.name}]: ${e.message}`}}_cmdArgs(e){for(const t of this._cmds.keys())if(e===t||e.startsWith(t+" "))return[t,this._args(e.substring(t.length+1))];return[]}_args(t){return e.split(t," ",1/0,!0).filter((e=>e)).map(no)}_help(t){e.trigger(Kl,"open"),e.trigger(Kl,"help",t)}_plugIns(t,n){e.trigger(Vl,_.plugIns,Ul(t,n))}_plugDel(t){e.trigger(Vl,_.plugDel,function(t){let n=Rl.get(t),r=`${b.plugRoot}/${t}`,l=Il.get(r);return n&&(Rl.delete(t),f.templater(t,null)),l&&(e.remove(l),Il.delete(r)),n||null}(t))}_config(e,t){if(void 0===t)return w[e].toString()||E.configNothing;if(void 0===T[e])throw new Error(`${e} option is not supported`);return`Fx.${e}=${T[e]=t&&JSON.parse(t)}`}_replace(...e){return e.length?this._eset.size?[new eo([...this._eset],...e)]:E.selectNone:E.missContent}}class Jl{constructor(e,t){this._set=e,this._ctx=t}exec(t,n){let r=new Function("$$","$","_",`return ${t};`),l=null;try{l=r(e(this._set),n,this._ctx)}catch(e){l=`[${e.name}]: ${e.message}`}return""+l}}class Yl{constructor(){this._buf=[]}add(e){this._buf[this._buf.length-1]!==e&&this._buf.push(e)}find(e){let t=this._buf.slice().reverse(),n=[],r=0;for(;r>=0;)r=this._indexOf(e,t,r),r>=0&&n.push(t[r++]);return n}size(){return this._buf.length}_indexOf(e,t,n=0){for(;n<t.length;n++)if(t[n].startsWith(e))return n;return-1}}class Ql{constructor(e){this._buf=e,this._idx=0}next(){let e=this.size()-1;return this._idx<e?this._buf[++this._idx]:null}prev(){return this._idx>0?this._buf[--this._idx]:null}first(){return this._idx=0,this._buf[0]||null}last(){return this._idx=this._buf.length-1,this._buf[this._idx]||null}reset(){return this._idx=0,this}size(){return this._buf.length}}const Zl={[x.select]:new Yl,[x.filter]:new Yl,[x.search]:new Yl,[x.command]:new Yl,[x.calcuate]:new Yl};class eo{constructor(t,n,r){if(!this._checks(t))throw new Error(E.needContent);void 0===r?[n,r]=[/[^]+/,n]:n=this._regstr(n),this._tts=e(t).map((e=>e.textContent.replace(n,r))).Text(),this._els=t,this._old=t.map(((e,t)=>this._fill(e,this._tts[t])))}undo(){this._els.forEach(((e,t)=>this._fill(e,this._old[t])))}redo(){this._els.forEach(((e,t)=>this._fill(e,this._tts[t])))}_checks(e){return e.every((e=>dn(e)))}_regstr(e){return jl.test(e)?new RegExp(...e.match(jl).slice(1)):e}_fill(t,n){let r=[...t.childNodes];return t.textContent="",t.append(...e.isArray(n)?n:[n]),r}}function to(e,t){return e.reduce(((e,t)=>(new Gl).execOne(t,e)),t)}function no(e){return Pl.test(e)?e.match(Pl)[2]:e}function ro(t,n){Kl=t,Vl=n,e.trigger(n,_.plugInit,b.plugList.reduce(((e,t)=>e.then((e=>Ul(t[0],t[1]).then((t=>e.push(t)&&e))))),Promise.resolve([])))}function lo(e){return Zl[e]}
//! $ID: edit.js 2019.09.07 Cooljed.Libs $
const oo=e.Fx.History.Normalize,io=`${_.selectedClass} ${_.focusClass} ${_.hoverClass} ${_.pointClass}`,so=`.${_.selectedClass}, .${_.focusClass}, .${_.hoverClass}, .${_.pointClass}`,ao=Symbol(),uo=/\s+/g,co=/\n\s*\n/,fo=/(\s)\s*/g,po=/\r\n|\n|\r/,ho=/section|article/i,mo=/\sclass="[\w\s]+"/,go={[Ie]:["dd",ot],[Ae]:["p",at],[Ce]:["p",qe],[Ce]:["p",Je],[Ce]:["p",Ye],[Ce]:["p",it],[Ce]:["p",st]},_o=new Set([Re,Ie,Le,we,ye,ve,xe]),wo={minied:"miniedIn",toup:"indentReduce",todown:"indentIncrease",delete:"deletes",range:"elementRange",property:"properties"},vo={children:ts,siblings:function(e){return ts([...Zi(e)])}},yo=new Set(["a","ruby","bdo","fcona"]),bo=`${t.on} ${t.by} ${t.to}`,xo=new Set([t.on,t.by,t.to,bo]),Eo=new Sn(_.selectedClass),To=new class{constructor(e){this._cls=e,this._its=null}set(e){let t=this._its;return t!==e&&this._set(e),t}get(){return this._its||null}is(e){return!!e&&e===this._its}cancel(){return this._its&&e.removeClass(this._its,this._cls),this._its=null}_set(t){if(null==t)return this.cancel();this._its&&e.removeClass(this._its,this._cls),this._its=e.addClass(t,this._cls)}}(_.focusClass),Co=new class{constructor(t="_cursor_"){let n=t+(Date.now()%4294967295).toString(16);this._cel=e.attr(e.elem("i"),n,""),this._slr=`[${n}]`}cursor(t,n){let r=n.commonAncestorContainer,l=e.contains(t,r);return l&&(3===r.nodeType&&0===n.endOffset&&n.setEnd(n.endContainer,1),n.collapse(!1),n.insertNode(this._cel)),n.detach(),l&&t}active(t){let n=e.get(this._slr,t),r=document.createRange();return n?(r.selectNode(n),r.deleteContents(),t.normalize()):r.selectNodeContents(t),this._active(r,t)}active2(t,n=!1){let r=e.get(this._slr,t),l=document.createRange();return r&&(r.remove(),t.normalize()),l.selectNodeContents(t),l.collapse(n),this._active(l,t)}clean(t){let n=e.get(this._slr,t);return n&&(n.remove(),t.normalize()),n&&t}_active(e,t){let n=window.getSelection();return n.removeAllRanges(),n.addRange(e),e.detach(),t.focus(),t}},No=new e.Fx.History,So=new An(`${_.nameEditor}_`),$o=new $(";",new A,new k);class Ao{constructor(e,...t){this._fun=e,this._vals=t,this.count=null,this.redo()}undo(){this.count>0&&No.back(this.count)}redo(){let e=No.size();this._fun(...this._vals),this.count=No.size()-e}changed(){return this.count>0}}class ko{constructor(e,...t){this._fun=e,this._args=t,this._data,this.count=null,this.redo()}undo(){this.count>0&&No.back(this.count)}redo(){let e=No.size();this._data=this._fun(...this._args),this.count=No.size()-e}changed(){return this.count>0}result(){return this._data}warn(e){if(void 0===e)return this._msg;this._msg=e}}class Oo{constructor(e,t){this._nds=e,this._old=e.map((e=>e.textContent)),this._tts=this._old.map(t),this.redo()}undo(){this._nds.forEach(((e,t)=>e.textContent=this._old[t]))}redo(){this._nds.forEach(((e,t)=>e.textContent=this._tts[t]))}}class Ro{constructor(e,...t){this._fun=e,this._vals=t,this._old=[...Eo],this.redo()}undo(){Eo.clear().pushes(this._old),es(Jo,_.evnFollow)}redo(){this._fun(...this._vals),es(Jo,_.evnFollow)}}class Io{constructor(e=To.get()){this._hot=e,this._old=ni(e)}undo(){ni(this._old)}redo(){ni(this._hot)}}class Lo{constructor(e){e&&this.redo()}undo(){es(Jo,_.evnFollow)}redo(){es(Jo,_.evnFollow)}}class zo{constructor(e,t){this._el=Rr(t,...this._optData(t,e)),this._old=[...e.extractContents().childNodes],e.insertNode(this._el),e.collapse(),e.detach(),this._tmp=null}undo(){let e=this._el.parentElement;this._el.replaceWith(...this._old),this._tmp=new oo(e)}redo(){this._tmp.back(),this._old.slice(1).forEach((e=>e.remove())),this._old[0].replaceWith(this._el)}elem(){return this._el}completed(){return this._whole}_optData(e,t){let n=this[`_${e}`],r=t.cloneContents();return n?n(this,t.toString(),r):[null,r]}_a(e,t,n){return e._whole=zo.url.test(t.trim()),[e._whole&&{href:t},n]}_fcona(t,n,r){return[{},e.contents(r,null,!1,!0),!0]}_ruby(e,t,n){let r=t.trim().match(zo.ruby),l=r?r[2]:_.rtHolder,o=r?r[1]:n;return e._whole=r,[{rt:l},o]}}zo.url=/^(?:http|https|ftp|email):\/\/\w[\w.-]+\/\S+$/i,zo.ruby=RegExp(`^([\\S\\x20]+)\\${_.rpLeft}([\\w\\u00c0-\\u017e\\u3105-\\u312d ]+)\\${_.rpRight}$`,"i");class Uo{constructor(t){this._el=e.attr(e.elem("mark",t.toString()),"role","tmp"),this._old=[...t.extractContents().childNodes],t.insertNode(this._el),t.detach(),this._tmp=null}undo(){let e=this._el.parentElement;this._el.replaceWith(...this._old),this._tmp=new oo(e)}redo(){this._tmp.back(),this._old.slice(1).forEach((e=>e.remove())),this._old[0].replaceWith(this._el)}elem(){return this._el}}class Do{constructor(e,t){this._cp=this._clone(e,t),this._el=e,e.replaceWith(this._cp),this._cp.setAttribute("contenteditable",!0)}active(){Co.active(this._cp)}activeEnd(){Co.active2(this._cp,!1)}done(){let t=this._clean(e.clone(this._cp),rn(this._cp));xs((()=>e.fill(e.removeAttr(this._cp,"contenteditable"),t)))}elem(){return this._cp}original(){return this._el}undo(){this._cp.replaceWith(this._el)}redo(){this._el.replaceWith(this._cp)}_clone(t,n){Co.cursor(t,n);let r=e.clone(t,!0,!0,!0);return Co.clean(t),r}_clean(t,n){return e.fill(t,this._inlines(t.childNodes)),n===be?e("br",t).replace("\n"):n===le&&this._codeparse(t),[...e.normalize(t).childNodes]}_inlines(e){let t=[];for(const n of e){let e=n.nodeType;3===e||8===e?t.push(n):1===e&&t.push(Vn(n))}return t}_codeparse(t){let n=e.attr(t,"-lang");if(!n)return e("br",t).replace("\n");e.html(t,cl(null,tr([t.textContent],n),al,!1).map((e=>e.innerHTML)).join(""))}}const Ho=new class{only(e){if(1==Eo.size&&Eo.has(e))return!1;Eo.clear(),Eo.add(e)}turn(e){Eo.has(e)?Eo.delete(e):this.clean(e).add(e)}reverse(e){for(const t of e)Eo.has(t)?Eo.delete(t):this._parentAdd(t)}expand(e,t){return Eo.has(t)?this.adds(e):this.removes(e)}adds(e){e.forEach((e=>Eo.has(e)||this._parentAdd(e)))}removes(e){e.forEach((e=>Eo.has(e)&&Eo.delete(e)))}empty(){if(0==Eo.size)return!1;Eo.clear()}add(e){Eo.has(e)||this.clean(e).add(e)}safeAdd(e){Eo.has(e)||Eo.add(e)}safeAdds(e){Eo.pushes(e)}delete(e){return Eo.has(e)&&Eo.delete(e)}unshift(e){let t=[...Eo];t.length&&Eo.clear(),this.adds(e.concat(t))}cleanUp(e){let t=this._parentItem(e);return!!t&&(Eo.delete(t),Eo)}cleanDown(e){let t=this._contains(e);return!!t.length&&(t.forEach((e=>Eo.delete(e))),Eo)}clean(e){return this.cleanUp(e)||this.cleanDown(e)||Eo}_parentAdd(e){this.cleanDown(e),Eo.add(e)}_parentItem(t){for(const n of Eo)if(e.contains(n,t,!0))return n;return null}_contains(t){let n=[];return Eo.forEach((r=>e.contains(t,r,!0)&&n.push(r))),n}},Mo=new class{toText(e){e.text(e.text())}unWrap(t){let n=new Set;t.forEach((e=>n.add(e.parentElement))),t.unwrap(),e(n).normalize()}newAfter(t,n){e.after(t,n)}newBefore(t,n){e.before(t,n)}newPrepend(t,n){e.prepend(t,n)}newAppend(t,n){e.append(t,n)}cloneAfter(t,n){t.forEach(((t,r)=>e.after(t,n[r])))}appends(t,n){t.forEach((t=>e.append(t,n)))}fills(t,n){t.forEach((t=>e.fill(t,n)))}replaces(t,n){t.forEach(((t,r)=>e.replace(t,n[r])))}replacex(t,n){e.replace(t[0],n),t.slice(1).forEach((t=>e.remove(t)))}insert(t,n,r){t?e.before(t,r):e.append(n,r)}alignInsert(t,n,r){t.forEach(((t,l)=>e[n](t,r[l])))}reverses(e){for(const t of e){let e=t.length-1;for(let n=0;n<parseInt(t.length/2);n++)Pn(t[n],t[e-n])}}merges(t,n,r){e.append(t,n),r.filter(Gi).remove()}movePrev(t,n){for(const r of t)0===n?e.before(Fn(r[0],1/0),r):r.forEach((t=>e.before(Fn(t,n),t)))}moveNext(t,n){for(const r of t)0===n?e.after(jn(ys(r),1/0),r):r.reverse().forEach((t=>e.after(jn(t,n),t)))}sectionsUp(t){t.forEach((t=>function(t){let n=t.parentElement;if("s1"===e.attr(t,"role"))return Ts(E.sectionNotUp,t);e.after(n,function(t){return e.find("section",t).forEach((e=>xn(e,-1))),xn(t,-1)}(t)||t)}(t))),ri()}sectionsDown(t){t.forEach((t=>{return n=t[0],r=t[1],function(t){e.find("section",t).forEach((e=>xn(e,1))),xn(t,1)}(n),void e.append(e.replace(n,r),n);var n,r})),ri()}styles(t,n,r){for(const l of t)e.cssSets(l,n,r)}attrs(t,n,r){for(const l of t)e.attribute(l,n,r)}},Fo=new kn(w.history,No);let jo=null,Po=null,Bo=null,Ko=null,Vo=null,Wo=null,Go=null,Xo=null,qo=null,Jo=null,Yo=null;function Qo(...e){Zo(),bs(null),Fo.push(...e.filter((e=>e)))}function Zo(){e.trigger(jo,_.redoEvent,!1,!0)}function ei(){Fo.clear(),e.trigger(jo,_.undoEvent,!1,!0),e.trigger(jo,_.redoEvent,!1,!0)}function ti(e,t){return void 0===t?e[ao]:(e[ao]=t,e)}function ni(t){try{return null==t?e.empty(Bo):(e.intoView(t,0),e.fill(Bo,function(t,n){return[t].concat(e.parentsUntil(t,(e=>e===n))).reverse().map((t=>ti(e.elem("b",function(e){let t=e.tagName.toLowerCase();return e.hasAttribute("role")&&(t+=":"+e.getAttribute("role")),t}(t)),t)))}(t,jo))),To.set(t)}finally{!function(t){e.trigger(Po,_.covert,t&&cn(t)&&os(t)||"")}(t)}}function ri(){let e=To.get();Eo.has(e)&&ni(e)}function li(e,t){Ho.cleanUp(t),Ho.expand(e,t)}function oi(e,t){e.forEach((e=>Ho.cleanUp(e))),Ho.expand(e,t)}function ii(e,t){e.forEach((e=>Ho.cleanUp(e))),Ho[t](e)}function si(e,t,n){n&&Ho.cleanUp(e),Ho[t](e)}function ai(e,t){return[new Ro(si,e,t),new Io(e)]}function ui(e,t){for(const n of e)Ho.cleanUp(n),Ho.adds(t(n))}function ci(e){Ho.empty(),Ho.safeAdds(e)}function fi(e){Ho.empty(),e.forEach((e=>Ho.add(e)))}function di(e){Ho.cleanUp(e),Ho.reverse(e.parentElement.children)}function pi(){return Eo.size>0&&new Ro((()=>Eo.clear()))}function hi(e){return(e=ws(e)).length>0&&new Ro((()=>Eo.pushes(e)))}function mi(t,n){let r=To.get();return r&&t.length?t.some((t=>e.contains(t,r,!n)))&&new Io(null):null}function gi(t,n){if(0!==t.length)return n&&!t.every(Gi)?(bs("has_cannot_del",Mi(t)),null):new Ao((()=>e(t).remove()))}function _i(e,t,n){return e.length>0&&new Ao(Mo[n],e,t)}function wi(t,n,r,l){if(!Ji(n))return bs("cannot_append",n);if(!t.every(Gi))return bs("has_cannot_del",Mi(t));let o=bi(r,n,t.clone(!0,!0,!0)),i=pi(),s=l&&new Ao((()=>e.empty(n)));return[new Io,i,s,new Ao((()=>t.remove())),o.length&&new Ao(Mo.insert,r,n,o),...yi(n,o)]}function vi(t,n,r,l){if(!Ji(n))return bs("cannot_append",n);let o=bi(r,n,t),i=pi(),s=l&&new Ao((()=>e.empty(n)));return[new Io,i,s,o.length&&new Ao(Mo.insert,r,n,o),...yi(n,o)]}function yi(e,t){return dn(e)?[new Ro((()=>Eo.add(e)))]:[hi(t),new Io(t[0])]}function bi(t,n,r){try{return xs((()=>r.map((e=>Or(t,n,{},e))).flat().map((t=>t&&e.remove(t))).filter((e=>e))))}catch(e){throw Ts(e,n)}}function xi(t,n,r){if(n=isNaN(n)?1:n||1/0,!t||n<0)return;let l=e.prevAll(t,((e,t)=>t<=n));return l.length&&r(l,t)}function Ei(t,n,r){if(n=isNaN(n)?1:n||1/0,!t||n<0)return;let l=e.nextAll(t,((e,t)=>t<=n));return l.length&&r(l,t)}function Ti(t,n,r){if(n=isNaN(n)?1:n,!t||n<=0)return;let l=e.closest(t,((e,t)=>t==n||e===jo));return l&&l!==jo&&r(l)}function Ci(t,n,r){if(n=n||0,!t||n<0)return;let l=e.children(t,n);return l&&r(l)}function Ni(e,t){let n=yn(e,jo);return n&&t(n)}function Si(t,n){return t.size===n.length&&e.every(t,((e,t)=>n[t]===e))}function $i(e,t,n){if(!e.length||e.some(ki))return;return new Ao(Mo.styles,e,t,(e=>`${(parseFloat(e)||0)+n}px`))}function Ai(e,t){return new Ao(Mo.styles,e,t,"auto")}function ki(t){return 108===rn(t)||"absolute"!==e.css(t,"position")}function Oi(t){let n=new Io(null),r=null,l=new Ao((()=>e.normalize(t)));return Eo.has(t)&&(r=new Ro(Ho.delete,t)),Yo=new Do(t,window.getSelection().getRangeAt(0)),e.trigger(jo,_.medIn,null,!0),e.trigger(Go,"hide"),e.trigger(qo,_.insType,_.miniedTpl),[n,r,l,Yo,new Io(Yo.elem())]}function Ri(t){let n=e.attr(e.elem(t.tagName),"role",e.attr(t,"role"));return[new Ao(Mo.newAfter,t,n),...Oi(n)]}function Ii(t,n){let r=rn(n),l=go[r];return zi(t,N.Keys.miniedSameLine)?_o.has(r)&&Ri(n):!!zi(t,N.Keys.miniedLogicLine)&&(function(e,t){return e&&e[1]===rn(t.parentElement)}(l,n)?function(t,n){let r=e.elem(n);return[new Ao(Mo.newAfter,t,r),...Oi(r)]}(n,l[0]):_o.has(r)&&Ri(n))}const Li={[_.levelName1]:[Mo.newAfter,Mo.newBefore],[_.levelName2]:[Mo.newAppend,Mo.newPrepend]};function zi(e,t){let n=t.split(uo);return n.length===e.size&&n.every((t=>e.has(t.toLowerCase())))}function Ui(e){let t=new Map;for(const n of e){let e=n.parentElement;(t.get(e)||t.set(e,[]).get(e)).push(n)}return[...t.values()]}function Di(t){let n=To.get(),r=e.contains(t,n);try{return r&&To.cancel(),an(t)}finally{r&&To.set(n)}}function Hi(e,t){return t=isNaN(t)?1:t,new Array(t).fill().map((()=>an(e)))}function Mi(e){for(const t of e)if(!Gi(t))return t}function Fi(e){for(const t of e)if(!gn(t))return t}function ji(e){for(const t of e)if(_n(t))return t}function Pi(t,n,r){let l=n.cellIndex(t);return e.isArray(l)?function(e,[t,n],r){let l=new Set;for(let o=t;o<n;o++)e.column(o,r).forEach((e=>l.add(e)));return[...l]}(n,l,r):n.column(l,r)}function Bi(t,n){if(!t)return;let r=t.parentElement;if(!e.contains(r,n,!0))return null;for(;n.parentElement!==r;)n=n.parentElement;return n}function Ki(e){return(e=e.parentElement)!==jo&&e}function Vi(e){let t=new Set,n=0;for(const[r,l]of e.entries()){let e=l.parentElement;if(n+=e.childElementCount,t.add(e).size===r)throw Ts("repeat sibling",l)}if(n===e.size)throw Ts("no more sibling")}function Wi(e,t){return t=t||e[0].tagName,e.every((e=>e.tagName===t))}function Gi(e){let t=rn(e);return kt(t)||Ot(t)||Lt(t)}function Xi(e){let t=rn(e);return It(t)||Ot(t)&&!Et(t)}function qi(e){let t=rn(e);return dn(e.parentElement)&&It(t)||t===X}function Ji(e){let t=rn(e);return!Et(t)&&!At(t)}function Yi(e,t){return Ji({prepend:e,append:e,fill:e,before:e.parentElement,after:e.parentElement,replace:e.parentElement}[t])}function Qi(e){return e.reduce(((e,t)=>e.add(rn(t))),new Set)}function Zi(e){let t=new Set;for(const n of e)n.parentElement&&t.add(n.parentElement);return t}function es(t,n,r=1,...l){setTimeout((()=>t.isConnected&&e.trigger(t,n,...l)),r)}function ts(t){return function(t){let n=t.shift();if(!n||"TABLE"===n.tagName&&t.length>0)return[];let r=[...sn(n)];return t.length>0&&(r=r.filter((e=>t.every((t=>on(t,e)))))),e.map(r.filter((e=>!Dr.has(e))),(e=>zr[e]))}(t.filter((e=>!At(rn(e)))))}function ns(t,n,r="text"){return t?e("tr",t).find(n)[r]():null}function rs(e,t){return e&&Mn(e).then((e=>e?ws(e).map((e=>Rr(t,e))):[]))}function ls(e){let t=e.commonAncestorContainer;return 3===t.nodeType?t.parentElement:t}function os(e){let t=[...e.attributes].map((e=>`${e.name}="${e.value}"`)).join(" ");return t?`<${e.tagName} ${t}>`:`<${e.tagName}>`}function is(e){return ss(e).outerHTML}function ss(t){let n=e.clone(t);return e.find(so,n,!0).forEach((t=>e.removeClass(t,io))),n}function as(e,t,n,r){let l=[...e];return l.length||(l=[...jo.children]),n&&(t.TEXT=l.map((e=>e.textContent))),r&&(t.HTML=l.map(is)),t}function us(e,t){let n,r=new Function("$$","$","_",e);try{n=r(t,cs,jo)}catch(e){return{type:"error",data:e}}return void 0===n?null:{type:"value",data:n,code:e}}const cs=new Proxy(e,{apply:(e,t,n)=>e(n[0],n[1]||jo)});function fs(e,t){return t.some((t=>""!==e.style[t]))}function ds(e,t){let n=e[0].style[t];for(const r of e.slice(1))if(r.style[t]!==n)return null;return n}function ps(t,n){let r=sn(t),l=[];for(const e of n)(3!==e.nodeType||e.textContent.trim())&&(Tn(e,r)||l.push(e));return l.length?l:function(t){for(const n of t){if(1!==n.nodeType)continue;let t=ps(n,e.contents(n));if(t)return t}}(n)}function hs(e){return 3===e.nodeType?e.textContent:e.cloneNode().outerHTML.replace(RegExp(`</${e.tagName}>$`,"i"),"")}function ms(e,...t){for(const n of t)[n[e],n[e-1]]=[n[e-1],n[e]]}function gs(e){return $o.reset(),[...$o.split(e)].join(" ").trim()}function _s(e,t="-"){let n=e.length;for(;n--&&(!e[n]||e[n]===t););return n+1}function ws(t){return e.isArray(t)?t:[t]}function vs(e){for(const t of e.values())return t}function ys(e){return e[e.length-1]}function bs(t,n=null){if(null===t)return e.trigger(Ko,"off");let[r,l]=C[t];e.trigger(ti(Ko,n),"on"),e.trigger(e.get("a",Ko),"setv",[r,l,l])}function xs(t){let n=e.config({varyevent:!1,bindevent:!1});try{return t()}finally{e.config(n)}}function Es(e){es(Vo,_.info,10,e)}function Ts(t,n){return e.trigger(ti(Ko,n),"on"),e.trigger(e.get("a",Ko),"setv",[null,t,t]),new Error(t)}const Cs={[x.select]:null,[x.filter]:null,[x.search]:null,[x.command]:null,[x.calcuate]:null},Ns={[x.select]:function(e,t){if(!e.exec(t,To.get()).length)return E.selectNone;return Ss([],e.exec(t,To.get()))},[x.filter]:function(e,t){return Ss([],e.exec(t))},[x.search]:function(t,n){let r=(Eo.size?e(Eo):e(jo.children)).textNodes(!0,!0).flat(),l=r.length&&t.exec(n,r);if(!l.length)return`${E.searchNothing} ${n}`;let o=l.map((e=>new Uo(e)));return Ss(o,o.map((e=>e.elem())))},[x.command]:function(e,t){return e.exec(t)},[x.calcuate]:function(e,t){let n=e.exec.bind(e),r=new ko(n,t,To.get());r.changed()&&(r.warn(E.undoWarn),Qo(r));return r.result()}};function Ss(e,t){return e.concat(pi(),hi(t),new Io(t[0]))}function $s(t){let n={},r=[];for(const l of t){let[t,o]=Lr(l);r.push(o),e.assign(n,t)}return[n,r]}function As(t,n){let r=function(e){let t=Mt[e.toUpperCase()];return sr[t]?_.convBlocks:ar[t]?_.convLines:ir[t]?_.convInlines:null}(t);switch(r){case _.convInlines:return function(e,t){let[n,r]=$s(t),l=r.map((t=>Rr(e,n,t)));return[new Ao(Mo.replaces,t,l),l]}(t,n);case _.convLines:return function(t,n){let[r,l]=$s(n),o=l.map((n=>e.isArray(n)?n.map((e=>Rr(t,r,e))):Rr(t,r,n)));return[new Ao(Mo.replaces,n,o),o.flat()]}(t,n);case _.convBlocks:return function(e,t){let[n,r]=$s(t),l=null;return Ir(t[0])===_.convLines?(l=Rr(e,n,r,!0),[new Ao(Mo.replacex,t,l),[l]]):(l=r.map((t=>Rr(e,n,t,!0))),[new Ao(Mo.replaces,t,l),l])}(t,n)}throw new Error(`[${t}] convert is not supported.`)}const ks={[Ee]:{self:">h1, >hgroup",prev:null},500:{self:">h1, >hgroup",prev:null},[qe]:{self:">header[role=abstract]",prev:[Ee]},507:{self:">nav[role=toc]",prev:[qe,Ee]},512:{self:">article",prev:[507,qe,Ee]},508:{self:">nav[role=reference]",prev:[512,507,qe,Ee]},509:{self:">aside[role=seealso]",prev:[508,512,507,qe,Ee]},[Ye]:{self:">footer",prev:[509,508,512,507,qe,Ee]}},Os={[Ee]:{self:">h1",prev:null},[Te]:{self:">h2",prev:null},[Ne]:{self:">h4",prev:null},[Fe]:{self:">h5",prev:null},[Ae]:{self:">summary",prev:null},[ke]:{self:">figcaption",prev:null},[Oe]:{self:">caption",prev:null},415:{self:">thead",prev:[Oe]},416:{self:">tbody:last-of-type",prev:[415,Oe]},417:{self:">tfoot",prev:[416,415,Oe]},[Je]:{self:">header",prev:[Te]},[Ye]:{self:">footer",prev:["LastChild"]},[V]:{self:">img",prev:["LastChild"]},LastChild:{self:">:last-child",prev:null}};function Rs(t,n,r){let l=null;if(!n)return l;for(const o of n)if(l=e.get(r[o].self,t),l)break;return l}function Is(t,n,r){let l=r[rn(n)],o=e.get(l.self,t);return o?new Ao((()=>e.replace(o,n))):(o=Rs(t,l.prev,r),new Ao(o?()=>e.after(o,n):()=>e.prepend(t,n)))}function Ls(t,n,r=jo){let l=ks[t],o=e.get(l.self,r);if(o)return e.replace(o,n);let i=Rs(r,l.prev,ks);return i?e.after(i,n):e.prepend(r,n)}function zs(e){return Wi(e,"SECTION")&&e.some((e=>rn(e)!==Ke))}function Us(e){return Wi(e,"SECTION")}function Ds(e){return 1===e.length&&Rt(rn(e[0]))}function Hs(e){let t=[...Qi(e)];return t.length>1||t[0]===Re&&"OL"!==e[0].parentElement.tagName?null:Ur[t[0]]||null}const Ms=[function(e){return dn(e[0])},function(){return null!==Js.convtype()},zs,Us,function(e){return e.every(Gi)},Ds,Hs],Fs={[Ke]:Ks,[Ve]:Ks,[We]:Ks,[Ge]:Ks,[Xe]:Ks,[Qe]:Ks,521:function(e){return Vs(e,">caption, >thead, >tfoot")},[De]:null,[Je]:Bs,[Ye]:Bs,[it]:Bs,[st]:Bs,[at]:function(e){return Vs(e,">summary")}};function js(e){let t=Fs[e];return null===t?null:t||Ps}function Ps(t){return e.children(t)}function Bs(e){return Vs(e,">h4")}function Ks(e){return Vs(e,">h2")}function Vs(t,n){let r=e.children(t);for(const l of e.find(n,t)){let e=r.indexOf(l);e>=0&&r.splice(e,1)}return r}function Ws(t,n){let r=rn(t);if(It(r))return!$t(r)&&n.every(dn)&&e(n).contents().flat();let l=[...Qi(n)];return 521===r?1===l.length&&521===l[0]&&function(e,t){let n=wn(e).cols();return t.every((e=>n===wn(e).cols()))}(t,n)&&Gs(n):function(e,t){let n=qt[e];return void 0===n?!Et(e)&&!At(e)&&t.every((t=>t===e)):t.every((e=>n===qt[e]))}(r,l)&&Gs(n)}function Gs(e){let t=[];for(const n of e){let e=js(rn(n));e&&t.push(...e(n))}return t}function Xs(e,t){let n=rn(e);return It(n)?$t(n)?e:function(e){for(const t of e)if(!dn(t))return t}(t):521===n?function(e,t){let n=wn(e).cols();for(const e of t)if("TABLE"!==e.tagName||n!==wn(e).cols())return e;return null}(e,t):Et(n)||At(n)?e:En(e,t)}const qs={focusPrevious(e){xi(To.get(),e,(e=>ni(ys(e))))},focusNext(e){Ei(To.get(),e,(e=>ni(ys(e))))},focusParent(e){Ti(To.get(),e,(e=>ni(e)))},focusChild(e){Ci(To.get(),e,(e=>ni(e)))},focusItemTop(){Ni(To.get(),(e=>ni(e)))},focusSetNext(){let e=To.get(),t=Eo.next(e);t&&t!==e&&ni(t)},focusSetPrev(){let e=To.get(),t=Eo.prev(e);t&&t!==e&&ni(t)},click(t,n){let r=To.get(),l=t.data;if(zi(n,N.Keys.elemFocus))return ni(l);if(zi(n,N.Keys.acrossSelect)){let t=Bi(r,l),n=t&&((o=r)===(i=t)?[]:[o,...e.next(o,i,!0)?e.nextUntil(o,i):e.prevUntil(o,i),i]);return t&&n.length&&Qo(new Ro(li,n,r),new Io(t))}var o,i;if(zi(n,N.Keys.smartSelect)){let e=Bi(r,l);return e&&Qo(...ai(e,"turn"))}if(zi(n,N.Keys.parentFocus)){let e=Ki(l);return e&&ni(e)}if(zi(n,N.Keys.parentSelect)){let e=Ki(l);return e&&Qo(...ai(e,"turn"))}if(zi(n,N.Keys.turnSelect))return Qo(...ai(l,"turn"));zi(n,N.Keys.onlyParent)&&(l=Ki(l)),Eo.has(l)&&r===l&&1===Eo.size||Qo(...ai(l,"only"))},__click:1,pathTo(t,n){if(e.intoView(t.data,0),!zi(n,N.Keys.elemFocus))return zi(n,N.Keys.turnSelect)?Qo(...ai(t.data,"turn")):void(Eo.has(t.data)||Qo(...ai(t.data,"add")));To.set(t.data)},__pathTo:1,turn(){let e=To.get();e&&Qo(...ai(e,"turn"))},reverse(){let e=To.get();e&&Qo(new Ro(di,e))},siblings(){let t=To.get();if(!t)return;let n=e.siblings(t);n.length&&Qo(new Ro(li,n,t))},tagsame(){let t=To.get();if(!t)return;let n=e.siblings(t,t.tagName);n.length&&Qo(new Ro(li,n,t))},tagsame2(){let t=To.get();if(!t)return;let n=e.find(`>* >${t.tagName}`,t.parentElement.parentElement);n.splice(n.indexOf(t),1),n.length&&Qo(new Ro(oi,n,t))},tagsame2x(){let t=To.get();if(!t)return;let n=t.parentElement,r=null;if("TR"===n.tagName){let e=n.parentElement;r=Pi(t,wn(e.parentElement),e)}else r=e.find(">* >"+`${(l=t).tagName}:nth-child(${e.prevAll(l).length+1})`,n.parentElement);var l;r.splice(r.indexOf(t),1),r.length&&Qo(new Ro(oi,r,t))},cleanSiblings(){let t=To.get();if(!t||1===Eo.size&&Eo.has(t))return;let n=e.children(t.parentElement).filter((e=>Eo.has(e)));Qo(new Ro(Ho.removes,n),new Ro(ai,t,"add"))},cleanOthers(){let e=To.get();!e||1===Eo.size&&Eo.has(e)||Qo(new Ro(Ho.empty),new Ro(ai,e,"safeAdd"))},contentBoxes(){let e=To.get();if(!e)return;let t=vn(e);t.some((e=>!Eo.has(e)))&&Qo(new Ro(ii,t,"adds"),new Io(t[0]))},contentBoxesStart(){let e=To.get();if(!e)return;let t=vn(e);t.some((e=>!Eo.has(e)))&&Qo(new Ro(ii,t,"unshift"),new Io(t[0]))},previous(e){xi(To.get(),e,((e,t)=>Qo(new Ro(li,e,t),new Io(ys(e)))))},next(e){Ei(To.get(),e,((e,t)=>Qo(new Ro(li,e,t),new Io(ys(e)))))},parent:e=>Ti(To.get(),e,(e=>Eo.has(e)||Qo(...ai(e,"add")))),child:e=>Ci(To.get(),e,(e=>Eo.has(e)||Qo(new Ro(si,e,"safeAdd",!0),new Io(e)))),itemTop(){Ni(To.get(),(e=>Eo.has(e)||Qo(...ai(e,"add"))))},onlyPrevious(e){xi(To.get(),e,(e=>Qo(...ai(ys(e),"only"))))},onlyNext(e){Ei(To.get(),e,(e=>Qo(...ai(ys(e),"only"))))},onlyParent(e){Ti(To.get(),e,(e=>Qo(...ai(e,"only"))))},onlyChild(e){Ci(To.get(),e,(e=>Qo(...ai(e,"only"))))},onlyItemTop(){Ni(To.get(),(e=>Qo(...ai(e,"only"))))},siblingsVF(){Vi(Eo),Qo(new Ro(ui,Eo,(t=>e.siblings(t))))},tagsameVF(){Vi(Eo),Qo(new Ro(ui,Eo,(t=>e.find(`>${t.tagName}`,t.parentElement))))},previousVF(t){Vi(Eo),t=isNaN(t)?1:t,Qo(new Ro(ui,Eo,(n=>e.prevAll(n,((e,n)=>n<=t)))))},nextVF(t){Vi(Eo),t=isNaN(t)?1:t,Qo(new Ro(ui,Eo,(n=>e.nextAll(n,((e,n)=>n<=t)))))},contentBoxesVF(){let e=[...Eo].map((e=>vn(e))).flat();Si(Eo,e)||Qo(new Ro(ci,e),new Io(e[0]))},childVF(t){t=t||0;let n=e.map(Eo,(n=>e.children(n,t)));Si(Eo,n)||Qo(new Ro(ci,n),new Io(n[0]))},parentVF(e){let t=new Set;for(const n of Eo)Ti(n,e,(e=>t.add(e)));t=[...t],Si(Eo,t)||Qo(new Ro(fi,t),new Io(t[0]))},itemTopVF(){let e=new Set;for(const t of Eo)Ni(t,(t=>e.add(t)));e=[...e],Si(Eo,e)||Qo(new Ro(fi,e),new Io(e[0]))},selectSort(){let t=e(Eo).sort().item();t.length<2||Qo(new Ro(ci,t),new Io(t[0]))||Es(E.sortCompleted)},selectReverse(){let t=e(Eo).sort().item().reverse();t.length<2||Qo(new Ro(ci,t),new Io(t[0]))||Es(E.sortCompleted)},toText(){let t=e(Eo);if(0!==t.length&&function(e){for(const t of e)if(t.childElementCount>0)return!0;return!1}(t))return t.every(Xi)?void Qo(mi(t),new Ao(Mo.toText,t)):bs("need_conelem",function(e){for(const t of e)if(!Xi(t))return t}(t))},__toText:null,unWrap(){let t=e(Eo);if(0!==t.length)return t.every(qi)?void Qo(mi(t,!0),pi(),new Ao(Mo.unWrap,t)):bs("both_conelem",function(e){for(const t of e)if(!qi(t))return t}(t))},__unWrap:null,deletes(){let t=e(Eo),n=gi(t,!0);return n&&Qo(mi(t,!0),pi(),n),!!n},deleteForce(){let t=e(Eo),n=gi(t);n&&Qo(mi(t,!0),pi(),n)},deleteContents(){let t=e(Eo).map((e=>vn(e))).flat(),n=function(t){if(0!==t.length)return new Ao((()=>e(t).empty()))}(t);n&&Qo(pi(),mi(t),n,hi(t))},elementCloneSelf(t){let n=e(Eo);if(!n.length)return;if(n.some(_n))return bs("only_child",ji(n));let r=n.map((e=>Di(e)));1===r.length&&(r=[Hi(r[0],t)]),Qo(new Io,mi(n,!0),pi(),new Ao(Mo.cloneAfter,n,r),hi(r.flat()))},elementCloneTeam(t){let n=e(Eo);if(!n.length)return;if(n.some(_n))return bs("only_child",ji(n));let r=function(e){let t=[e.shift()],n=[t];for(const r of e)r.previousElementSibling===ys(t)?t.push(r):n.push(t=[r]);return n}(n.sort()),l=r.map((e=>ys(e))),o=r.map((e=>e.map((e=>Di(e)))));1===o.length&&1===o[0].length&&(o[0]=Hi(o[0][0],t)),Qo(new Io,pi(),new Ao(Mo.cloneAfter,l,o),hi(o.flat()))},toUpperCase(){if(!Eo.size)return;let t=e(Eo).textNodes(!0,!0).flat();t.length&&Qo(new Oo(t,(e=>e.toUpperCase())))},toUpperCase1(){if(!Eo.size)return;let t=e(Eo).textNodes(!0,!0).map((e=>e[0]));t.length&&Qo(new Oo(t,(e=>e.replace(/[a-z]/,(e=>e.toUpperCase())))))},toLowerCase(){if(!Eo.size)return;let t=e(Eo).textNodes(!0,!0).flat();t.length&&Qo(new Oo(t,(e=>e.toLowerCase())))},elementFill(){let t=To.get();if(!t||!Eo.size)return;if(Eo.has(t))return bs("cannot_selected",t);let n=wi(e(Eo),t,null,!0);n&&Qo(...n)},elementCloneFill(){let t=To.get();if(!t||!Eo.size)return;if(1===Eo.size&&Eo.has(t))return;let n=vi(e(Eo).clone(),t,null,!0);n&&Qo(...n)},elementAppend(){let t=To.get();if(!t||!Eo.size)return;if(Eo.has(t))return bs("cannot_selected",t);let n=wi(e(Eo),t);n&&Qo(...n)},elementCloneAppend(){let t=To.get();if(!t||!Eo.size)return;let n=vi(e(Eo).clone(),t);n&&Qo(...n)},elementBefore(){let t=To.get();if(!t||!Eo.size)return;if(Eo.has(t))return bs("cannot_selected",t);let n=wi(e(Eo),t.parentElement,t);n&&Qo(...n)},elementCloneBefore(){let t=To.get();if(!t||!Eo.size)return;let n=vi(e(Eo).clone(),t.parentElement,t);n&&Qo(...n)},elementAfter(){let t=To.get();if(!t||!Eo.size)return;if(Eo.has(t))return bs("cannot_selected",t);let n=wi(e(Eo),t.parentElement,e.nextNode(t));n&&Qo(...n)},elementCloneAfter(){let t=To.get();if(!t||!Eo.size)return;let n=vi(e(Eo).clone(),t.parentElement,e.nextNode(t));n&&Qo(...n)},movePrevious(t){let n=e(Eo).sort(),r=n[0];if(!((t=isNaN(t)?1:t)<0||!n.length||function(t){let n=e.prevNode(t,!1,!0);return!n||pn(n)}(r)))return n.some(hn)?bs("has_fixed2",function(e){for(const t of e)if(hn(t))return t}(n)):void Qo(new Ao(Mo.movePrev,Ui(n),t))},moveNext(t){let n=e(Eo).sort(),r=ys(n);if(!((t=isNaN(t)?1:t)<0||!n.length||function(t){let n=e.nextNode(t,!1,!0);return!n||hn(n)}(r)))return n.some(pn)?bs("has_fixed1",function(e){for(const t of e)if(pn(t))return t}(n)):void Qo(new Ao(Mo.moveNext,Ui(n),t))},indentReduce(){let t=e(Eo);if(t.length)return zs(t)?void Qo(new Ao(Mo.sectionsUp,t)):bs("only_section",Fi(t))},indentIncrease(){let t=e(Eo);if(!t.length)return;if(!Us(t))return bs("only_section",Fi(t));let n=function(e){let t=[];for(const n of e){let e=rn(n);t.push([n,Rr(e,{h2:E.sectionH2})])}return!!t.length&&t}(t);Qo(new Ao(Mo.sectionsDown,n))},reversePlaces(){let t=e(Eo).sort(),n=Ui(t);if(!(t.length<2||n.every((e=>e.length<2))))return t.some(mn)?bs("has_fixed",function(e){for(const t of e)if(mn(t))return t}(t)):void Qo(new Ao(Mo.reverses,n))},contentsMerge(){let t=e(Eo),n=t.shift();if(!t.length)return;let r=Ws(n,t);if(!r)return bs("merge_types",Xs(n,t));Qo(mi(t,!0),pi(),new Ao(Mo.merges,n,r,t),...ai(n,"safeAdd"))},normalize(){let t=new Ao((()=>e.normalize(jo)));t.changed()&&Qo(t)},moveToLeft(){let e=[...Eo],t=$i(e,"left",-1);t&&Qo(t,Ai(e,"right"),new Lo(!0))},moveToLeftTen(){let e=[...Eo],t=$i(e,"left",-10);t&&Qo(t,Ai(e,"right"),new Lo(!0))},moveToRight(){let e=[...Eo],t=$i(e,"left",1);t&&Qo(t,Ai(e,"right"),new Lo(!0))},moveToRightTen(){let e=[...Eo],t=$i(e,"left",10);t&&Qo(t,Ai(e,"right"),new Lo(!0))},moveToUp(){let e=[...Eo],t=$i(e,"top",-1);t&&Qo(t,Ai(e,"bottom"),new Lo(!0))},moveToUpTen(){let e=[...Eo],t=$i(e,"top",-10);t&&Qo(t,Ai(e,"bottom"),new Lo(!0))},moveToDown(){let e=[...Eo],t=$i(e,"top",1);t&&Qo(t,Ai(e,"bottom"),new Lo(!0))},moveToDownTen(){let e=[...Eo],t=$i(e,"top",10);t&&Qo(t,Ai(e,"bottom"),new Lo(!0))},paste(e,t){let n=[...Eo].map((e=>vn(e))),r=n.flat(),l=t?"appends":"fills";r.length&&Qo(mi(r),...function(e,t,n){return 1===e.length?[_i(e[0],t.join("\n"),n)]:(1===t.length&&(t=new Array(e.length).fill(t[0])),e.map(((e,r)=>_i(e,t[r],n))))}(n,e.data,l))},__paste:1,setStyle(t,n,r){(function(t,n,r){return e.isArray(n)?t.some((e=>n.some((t=>e.style[t]!==r)))):t.some((e=>e.style[n]!==r))})(t.data,n,r)&&Qo(new Ao(Mo.styles,t.data,n,r),new Lo)},__setStyle:1,eraseStyle(e,t){let n=null;t=t.split(uo);for(const r of e.data)if(fs(r,t)){n=!0;break}n&&Qo(new Ao(Mo.styles,e.data,t,null),new Lo)},__eraseStyle:1,brushStyle(t){let n=t.data,r=e.attr(n,"style"),l=Eo.size,o=null;!r||!l||1===l&&Eo.has(n)||(Eo.has(n)&&(o=new Ro(Ho.delete,n)),Qo(o,new Ao(Mo.attrs,[...Eo],"style",r),new Lo))},__brushStyle:1,clearStyle(t){let n=null;for(const r of t.data)if(null!==e.attr(r,"style")){n=!0;break}n&&Qo(new Ao(Mo.styles,t.data,null),new Lo)},__clearStyle:1,attrUpdate(e,t){1===Eo.size&&Qo(new Ao(Mo.attrs,[...Eo],t,e.data),new Lo)},__attrUpdate:1,deleteAttr(e){Qo(new Ao(Mo.attrs,[...Eo],e.data,null),new Lo)},__deleteAttr:1,htmlUpdate(t){if(1!==Eo.size||!t.data.length)return;let n=[...Eo],r=function(t){let n=e.fragment(t);for(const t of e.find(so,n))e.removeClass(t,io);return e.contents(n)}(t.data);Qo(mi(n,!0),pi(),new Ao((()=>e.replace(n[0],r))))},__htmlUpdate:1,runScript(t,n,r,l){let o=t.data.trim();if(!o)return null;if("editor"===n){let t=new ko(us,o,e(Eo));return t.changed()&&(t.warn(E.undoWarn),Qo(t)),t.result()||tl(o)||null}return function(e){let t=Ln.pick();return new Promise(((n,r)=>{t.onmessage=e=>{t.onmessage=null,Ln.add(t),e.data.error?r(e.data.error):n(e.data.result)},t.postMessage(e)}))}(as(Eo,{code:o},r,l)).then((e=>({type:"value",data:e,code:o}))).catch((e=>({type:"error",data:e,code:""})))},__runScript:1,insResult(t,n,r){let l=t.data.trim(),o=[...Eo];if(!o.length||!r||!l)return;let i=function(e,t){for(const n of e)if(!Yi(n,t))return n;return null}(o,r);if(i)return bs("cannot_append",i);let s=function(t,n){switch(t){case"text":return e(e.Text(n,!0));case"html":return e(e.fragment(n).children)}throw new Error("can't to here.")}(n,l),a=pi(),u=o.map((e=>function(e,t,n){return bi(...{prepend:[null,e],append:[null,e],fill:[null,e],before:[e,e.parentElement],after:[e,e.parentElement],replace:[e,e.parentElement]}[t],n)}(e,r,s.clone())));Qo(new Io,a,new Ao(Mo.alignInsert,o,r,u))},__insResult:1,propUpdate(t,...n){let r=[...Eo],l=(o=rn(r[0]),pl[o]||((t,n,r)=>e.attr(t,n,r)));var o;if(1===r.length)return Qo(new Ao(l,r[0],t.data,...function(e,...t){let n=hl[rn(e)];return n?n(e,...t):function(e){return e.map((e=>""===e?null:e))}(t)}(r[0],...n)),new Lo(!0));let i=function(e,...t){let n=rn(e[0]),r=ml[n];return r?r(e,...t):Cl(e,function(e){return e.map((e=>""===e||null===e?void 0:e))}(t))}(r,...n);Qo(...r.map(((e,n)=>new Ao(l,e,t.data,...i[n]))))},__propUpdate:1,cmdRun(t,n){let r=t.data,l=r.trim()&&Ns[n](Cs[n],r);return lo(n).add(t.data),e.isArray(l)?(es(jo,"focus.content",1,null,!0),Qo(...l)||null):l},__cmdRun:1,pluginsRun(t){let l=(i=t.data,Ll.get(i)||null),o=e.attr(t.data,"title")||"";var i;if(!l)throw new Error("not found the plugins.");return function(e,t){let n=new Worker(e);return new Promise(((e,r)=>{n.onmessage=t=>{n.terminate(),t.data.error?r(t.data.error):e(t.data)},n.postMessage(t)}))}(`${y}${b.plugRoot}/${l}/${b.plugMain}`,as(Eo,{INFO:{}},!0,!0)).then((e=>function(e,t,l){let o=n.get(t);return l=e.title||l,e.node&&!e.error?[e.result,o.node(e.node),l]:(o=n.get(r),[e.error||e.result,o.node(b.plugResult),l])}(e,l,o)))},__pluginsRun:1,editUndo(){e.trigger(jo,_.undoEvent,Yo?(document.execCommand("undo"),document.queryCommandEnabled("undo")):(Fo.undo(),Fo.canUndo()),!0)},editRedo(){e.trigger(jo,_.redoEvent,Yo?(document.execCommand("redo"),document.queryCommandEnabled("redo")):(Fo.redo(),Fo.canRedo()),!0)},miniedIn(){let e=Eo.first();if(e){if(!dn(e))return ni(e),bs("need_conelem",e);Qo(...Oi(e)),Yo.active()}},miniedInEnd(){let e=Eo.first();if(e){if(!dn(e))return ni(e),bs("need_conelem",e);Qo(...Oi(e)),Yo.activeEnd()}},properties(){let t=e(Eo),l=Hs(t);if(!l)return bs("not_property",t[0]);!function(t){n.get(r).get(_.modalProp).then((n=>e.trigger(Xo,"open",[t,n])))}(l)},elementRange(){let t=[...Eo];if(!Ds(t))return bs("not_elrange",t[0]);e.select(t[0],!0),es(t[0],"_mouseup",10,null,!0)}},Js={undo(){qs.editUndo()},redo(){qs.editRedo()},sels:()=>e(Eo),esize:()=>Eo.size,sel0:()=>vs(Eo)||null,efocus:()=>To.get(),tobj:()=>Eo.size?wn(function(e){switch(e.tagName){case"TR":return e.parentElement.parentElement;case"TBODY":case"THEAD":case"TFOOT":case"CAPTION":return e.parentElement;case"TH":case"TD":return e.parentElement.parentElement.parentElement;case"TABLE":return e}throw new Error("not in table element.")}(Eo.first())):null,trbox(){let e=Eo.first();return"TR"===e.tagName?e.parentElement:e},tsecbox(){let e=Eo.first();return"TABLE"===e.tagName?e:e.parentElement},codebox(){let e=Eo.first();if(!e)return null;switch(rn(e)){case 526:return e.firstElementChild;case le:case tt:return e;case He:return e.parentElement}throw new Error("bad type of element.")},attrns:e=>[...e.data.attributes].map((e=>e.name)),__attrns:1,obtname(t){let n=t.data,r=e=>xo.has(e)?bo:e.replace(uo,"");return e.isArray(n)?[...new Set(n.map(r))]:r(n)},__obtname:1,obtsplit:e=>($o.reset(),e.data.map((e=>e?[...$o.split(e)].map((e=>e.trim())):[]))),__obtsplit:1,obtval:e=>function([e,t,n]){return t.length=_s(t),n.length=_s(n),e.length=Math.max(_s(e),t.length,n.length),[e,t,n]}(e.data.map((e=>e.map(gs).map((e=>e||"-"))))).map((e=>e.join(";\n")||null)),__obtval:1,source:e=>ti(e.data),__source:1,rngok(e){let t=rn(ls(e.data));return e.data.detach(),It(t)&&t!==le||425===t},__rngok:1,menupos(t,n,[r,l]){let o=e.outerWidth(t.data),i=e.offset(n),s=e.innerWidth(n),a=l-i.top+e.scrollTop(n)+w.popupGapTop;return r+o<s+i.left?[r-i.left+"px",`${a}px`]:[s-o-w.popupGapRight+"px",`${a}px`]},__menupos:1,submenu(t){let n=e.parent(t.data),r=e.outerWidth(n)-1+"px",l=e.children(t.data,-1),o=parseFloat(e.css(n,"right"));return e.outerWidth(l)>o?{left:"auto",right:r}:{left:r,right:"auto"}},__submenu:1,convtype(){let e=new Set;for(const t of Eo)e.add(Ir(t));if(e.size>1)return null;let t=vs(e);return t===_.convLines?_.convBlocks:t},__convtype:null,roleinfo(t,n){let r=e.attr(t.data,"role");return r?`${n}:${r}`:n},__roleinfo:1,elemSelf(e){let t=e.data;return t?os(t).replace(mo,""):null},__elemSelf:1,cmable(t){let n=[...Eo];return 0===n.length?[]:e.map(Ms,((e,r)=>e(n)?t.data[r]:null))},__cmable:1,inlable(t,n,r){let l=[...r.cloneContents().childNodes];return 0===l.length?[]:t.data.filter((t=>function(e,t,n){"a"===e&&425===rn(n)&&(e="fcona");let r=Rr(e),l=rn(r,n),o=sn(l);return t.every((e=>o.has(rn(e,r))))&&on(n,l)}(e.attr(t,n),l,ls(r))))},__inlable:1,inslist(e,t){if(!e.data.length)return null;let l=vo[t](e.data),o=n.get(r);return l.length?l.map((e=>o.node(e))):null},__inslist:1,ismixed:e=>(e.data===_.levelName1?[...Zi(Eo)]:[...Eo]).some((e=>ho.test(e.tagName)&&3===Dt(e))),__ismixed:1,pretreat2(e,t,n){let r=e.data;return r=n?r.trim().split(co):[r],t?r.map((e=>e.trim().replace(fo,"$1"))):r},__pretreat2:1,pretreat1(t,n){let r=t.data;return e.isArray(r)?n?r.map((e=>e.replace(fo,"$1"))):r:n?r.trim().replace(fo,"$1"):r},__pretreat1:1,splitx:(e,t)=>e.data.trim().split(t?co:po),__splitx:1,k3edit(t,n,r,l,o){let i=er(r,!0,t.data),s=l&&+e.val(l);switch(n){case"Enter":return`\n${a=i,a.substring(0,Qn(a,1/0))||" "}`;case"Tab":return function(e,t){return t>0?" ".repeat(t-Zn(e)%t):"\t"}(i,s)}var a;return s>0&&!r.toString()&&i.endsWith(" ".repeat(s))&&(o&&(s=i.length),r.setStart(r.endContainer,r.endOffset-s),r.setEnd(r.endContainer,r.endOffset)),null},__k3edit:1,indentcut(e,t){if(t)return e.data;let n=e.data.split(po).filter((e=>!!e)),r=function(e){let t=1/0;for(const n of e)if(t=Qn(n,t),!t)return 0;return t}(n);return r?n.map((e=>e.substring(r))).join("\n"):e.data},__indentcut:1,hlcode:(e,t,n)=>tr(e.data.split(po),n,t),__hlcode:1,codels:e=>cl(null,e.data,ul),__codels:1,codeblo:(e,{lang:t})=>cl(t,e.data,al),__codeblo:1,image3:(t,n)=>"svg"===n?e.svg({html:t.data}):Mn(t.data).then((e=>Rr(j,function(e){let[t,n]=e;return"string"!=typeof t&&([n,t]=[t,n]),Object.assign({src:t},n)}(e)))),__image3:1,mediasubs(e,t){let n=rs(e.data.trim(),B);return void 0===t?n:Promise.all([n,rs(t.trim(),P)])},__mediasubs:1,picsubs:e=>rs(e.data.trim(),K),__picsubs:1,cbstate(e,t,n){if(!e.data.length)return null;let r=e.data[0].style[t]===n;for(const l of e.data.slice(1)){if(l.style[t]===n!==r)return[!1,!0]}return[r,!1]},__cbstate:1,styVal:(t,n)=>t.data.length?e.isArray(n)?n.map((e=>ds(t.data,e))):ds(t.data,n):null,__styVal:1,unitVal(e){let t=e.data[0].value,n=e.data[1].value;return isNaN(parseFloat(t)-t)?t:t+n},__unitVal:1,styName:(e,t)=>e.data.length?t.split(uo).filter((t=>function(e,t){return e.every((e=>""!==e.style[t]))}(e.data,t))):null,__styName:1,styKey:(e,t)=>e.data.length?t.split(uo).filter((t=>function(e,t){return t+=":",e.every((e=>e.style.cssText.includes(t)))}(e.data,t))):null,__styKey:1,cleanHTML:e=>is(e.data),__cleanHTML:1,mdline:t=>T.mdline&&t.data?e.isArray(t.data)?t.data.map((t=>e.fragment(Kn(t)))):e.fragment(Kn(t.data)):t.data,__mdline:1,cmdclear(){this.cmdNavTemp=null},savedhtml:()=>So.get(_.storeMain),ecancel(){(Eo.size||To.get())&&Qo(new Io(null),new Ro(Ho.empty))},puthtml(t){let n=e.fragment(t.data);Qo(new Io(null),pi(),new Ao((t=>e.fill(jo,t)),[...n.childNodes]))},__puthtml:1,heading(t){if(jo.childElementCount>0)return;Qo(new Ao((t=>e.prepend(jo,t)),e.elem("h1",t.data)))},__heading:1,errmsg(e,t){zi(t,N.Keys.elemFocus)&&ni(e.data)},__errmsg:1,chapter(t){let n=e.get(t.data.map((e=>`>section:nth-of-type(${+e})`)).join(" ")+" >h2",e.get("article",jo));n&&e.intoView(n,1,1)},__chapter:1,save(t){let n=e(t.data.children).map(is).join("");return _.saver(n)||So.set(_.storeMain,n),E.localStoreDone},__save:1,export:t=>(t.data.length?t.data:e.children(jo)).map(is).join(""),__export:1,export2(t){let n=ss(jo),r=e.get("article",n);return Ls(507,Rr(507,{h4:t.data},r),n),e.html(n)},__export2:1,nicehtml(t,n,r){let l=isNaN(n)?"\t":" ".repeat(n),o=[...e.fragment(t.data).children];try{return o.map((e=>Bn(e,r,l))).join("").trim()}catch(t){e.trigger(e.get(`#${b.sourceTips}`),"show")}},__nicehtml:1,blankline(e,t,n){if(!t)return;let r=er(n,!0,e.data);r.length>1||" "!==r[0]||(n.setStart(n.endContainer,n.endOffset-1),n.setEnd(n.endContainer,n.endOffset))},__blankline:1,toclist:t=>wr(e.find(">section",t.data)),__toclist:1,medpass(t,n){let r=function(){Yo.done();let t=Yo.elem();return Zo(),"H2"===t.tagName&&e.trigger(Wo,_.medOk,t),e.trigger(jo,_.medOk,null,!0),e.trigger(Go,"show"),e.trigger(qo,_.insType,_.normalTpl),es(Jo,_.evnFollow),Yo=null,t}();if("Tab"===t.data)return qs.miniedIn();let l=Ii(n,r);l&&(Qo(...l),Yo.active())},__medpass:1,medcancel(){Fo.pop(),Zo(),Yo=null,e.trigger(Go,"show"),e.trigger(qo,_.insType,_.normalTpl)},__medcancel:null,rngelem(e,t){"a"===t&&425===rn(ls(e.data))&&(t="fcona");let n=pi(),r=new Io(null),l=new zo(e.data,t),o=l.elem();Qo(n,r,l,new Ro(si,o,"safeAdd"),new Io(o)),function(e,t){return yo.has(e)&&!t.completed()}(t,l)&&qs.properties()},__rngelem:1,cmenudo(e){let t=wo[e.data];t&&qs[t]()},__cmenudo:1,convert(e){if(!Eo.size)return;let t=[...Eo],n=mi(t,!0),r=pi(),[l,o]=As(e.data,t);Qo(n,r,l,hi(o)),yo.has(e.data)&&qs.properties()},__convert:1,croptr(t,n){if(n<=0)return;let r=t.data,l=n-r.rows.length;l&&function(t,n,r){if(n<0)return t.removes(n,null,r);t.inserts(n,null,r).map((e=>[...e.children])).flat().forEach((t=>e.attr(t,"contenteditable",!0)))}(e.table(r.parentElement),l,r)},__croptr:1,colcrop(t,n){if(n<=0)return;let r=e.table(t.data),l=n-r.cols()+1;l&&function(t,n){if(n<0)for(;n++<0;)t.removeColumn(-1);else(function(e,t){let n=[];for(;t-- >0;)n.push(e.insertColumn(e.newColumn()));return n})(t,n).flat().forEach((t=>e.attr(t,"contenteditable",!0)))}(r,l)},__colcrop:1,inserts(t,n,r){let l=[...Eo],o=function(t,n){if(n<2)return[t];if(t.length>1)return t;let r=t[0];for(let l=0;l<n-1;l++)t.push(e.clone(r));return t}(e(t.data),l.length),i=pi(),s=function(e,t,n,r){return e.map(((e,l)=>null!=t[l]&&new Ao(Li[r][+n],e,t[l])))}(l,o,n,r),a=o.flat().filter((e=>1===e.nodeType&&!cn(e)));Qo(i,...s,hi(a),a[0]&&new Io(a[0]))},__inserts:1,topinsert(e,t){let n=Eo.first(),r=t===_.levelName1?n.parentElement:n;Qo(pi(),Is(r,e.data,ks),...ai(e.data,"safeAdd"))},__topinsert:1,fixinsert(t,n){let r=n===_.levelName1?[...Zi(Eo)]:[...Eo],l=function(t,n){if(t=ws(t),n<2||t.length>1)return t;let r=t[0];for(let l=0;l<n-1;l++)t.push(e.clone(r));return t}(t.data,r.length);Qo(mi(r),pi(),...function(e,t){let n=[];return e.forEach(((e,r)=>null!=t[r]&&n.push(Is(e,t[r],Os)))),n}(r,l),hi(l),new Io(l[0]))},__fixinsert:1,instbody(t,n,r){let l=t.data,o=Eo.first(),i=r===_.levelName1?o.parentElement:o,s=wn(i),a=mi([i]),u=pi(),c=null;n?("TBODY"!==o.tagName&&(o=s.body(!0)),c=new Ao(Mo.newAppend,o,e.children(l)),l=null):("TBODY"!==o.tagName&&(o=e.get("tbody:last-of-type",i)),c=new Ao(Mo.newAfter,o,l)),Qo(a,u,c,...ai(l||o,"safeAdd"))},__instbody:1,table(e,t,[n,r,l,o]){let i=e.data,s=l?"":":not(:first-child)",a=l?"th,td":"td",u=ns(r&&i.tHead,`th${s}`),c=ns(i.tBodies[0],a),f=ns(o&&i.tFoot,a);return Rr("table",{cols:c[0].length-!!l,border:n,caption:t,th0:l=!!l,head:u,foot:f},c,!0)},__table:1,codelang(t,n,r){let l=t.data;if(n===e.attr(r,"-lang"))return l;for(const t of l)e.attr(t,"-lang")||e.attr(t,"-lang",n);return l},__codelang:1,checkhtml(t,n){let r=e.fragment(n),l=ps(t.data.parentElement,e.contents(r));return l?l.map(hs):null},__checkhtml:1,attrlist(t,n){let r=new Set(n);for(const n of t.data){let t=e.prop(n,"value");r.has(t)?r.delete(t):e.remove(n)}return[...r]},__attrlist:1,obtline(t,n,r,l){let o=e.siblingNth(t.data);return o<n.length&&n.splice(o,0,""),o<r.length&&r.splice(o,0,""),o<l.length&&l.splice(o,0,""),e.prop(e.clone(t.data),"text",null)},__obtline:1,obtdel(t,n,r,l){let o=e.siblingNth(t.data)-1;return n.splice(o,1),r.splice(o,1),l.splice(o,1),t.data},__obtdel:1,obtswap(t,n,[r,l,o]){let i=t.data;return"ArrowUp"===n?function(t,n,r,l){let o=e.prev(t);return o?(ms(e.siblingNth(o),n,r,l),[o,"after"]):null}(i,r,l,o):function(t,n,r,l){let o=e.next(t);return o?(ms(e.siblingNth(t),n,r,l),[o,"before"]):null}(i,r,l,o)},__obtswap:1,cmdlast(t,n,r){let l=n.selectionStart,o=lo(t.data).find(n.value.substring(0,l));this.cmdNavTemp=new Ql(o);let i=r?this.cmdNavTemp.last():this.cmdNavTemp.first();i&&e.val(n,i).setSelectionRange(l,i.length)},__cmdlast:1,cmdnext(t){let n=t.data,r=n.selectionStart,l=this.cmdNavTemp&&this.cmdNavTemp.next();l&&e.val(n,l).setSelectionRange(r,l.length)},__cmdnext:1,cmdprev(t){let n=t.data,r=n.selectionStart,l=this.cmdNavTemp&&this.cmdNavTemp.prev();l&&e.val(n,l).setSelectionRange(r,l.length)},__cmdprev:1,cmdNavTemp:null};
//! $ID: api.js 2021.10.21 Cooljed.Base $
let Ys;s(g,"Ed",qs,["click","pathTo","toText","unWrap","setStyle","eraseStyle","brushStyle","clearStyle","attrUpdate","deleteAttr","htmlUpdate","runScript","insResult","propUpdate","cmdRun","pluginsRun","deletes","paste"]),s(g,"Kit",Js,["ecancel","puthtml","heading","errmsg","chapter","save","export","export2","nicehtml","blankline","toclist","medpass","medcancel","rngelem","cmenudo","convert","croptr","colcrop","inserts","topinsert","fixinsert","instbody","table","codelang","checkhtml","attrlist","obtline","obtdel","obtswap","cmdlast","cmdnext","cmdprev"]),a(v,null,Js,["sels","esize","sel0","efocus","elemSelf","tobj","trbox","tsecbox","codebox","attrns","obtname","obtsplit","obtval","source","rngok","menupos","submenu","convtype","roleinfo","cmable","inlable","inslist","ismixed","pretreat2","pretreat1","splitx","k3edit","indentcut","hlcode","codels","codeblo","image3","mediasubs","picsubs","cbstate","styVal","unitVal","styName","styKey","cleanHTML","mdline","savedhtml","cmdclear"]),window.ESet=Eo,window.History=Fo;const Qs={init(e){Ys=e},heading(t){let n=e.get("h1",Ys);if(void 0===t)return n&&e.html(n);ei(),n||(n=e.prepend(e.get("hgroup",Ys)||Ys,e.elem("h1"))),e.html(n,t)},subtitle(t,n){let r=e.get("hgroup",Ys),l=r?e.find(">h3",r):[];if(void 0===t)return l.map((t=>e.html(t)));ei(),r||(r=e.prepend(Ys,e.elem("hgroup"))),n||l.forEach((t=>e.remove(t))),e.append(r,e(Zs(t)).Element("h3"))},abstract(t,n){let r=e.get(">header[role=abstract]",Ys);if(void 0===t&&void 0===n)return r&&ea(r);ei(),ta(t,n,r,qe)},article(t){let n=e.get("article",Ys);if(void 0===t)return n&&e.html(n);ei(),Ls(512,e.Element("article",t))},seealso(t,n){let r=e.get(">aside[role=seealso]",Ys);if(void 0===t&&void 0===n)return r&&na(r,"ul");ei(),ra(t,n,r,"ul",509)},reference(t,n){let r=e.get(">nav[role=reference]",Ys);if(void 0===t&&void 0===n)return r&&na(r,"ol");ei(),ra(t,n,r,"ol",508)},footer(t,n){let r=e.get(">footer",Ys);if(void 0===t&&void 0===n)return r&&ea(r);ei(),ta(t,n,r,Ye)},content(t){if(void 0===t)return e.html(Ys);ei(),e.html(Ys,t)},toc:(t=E.tocLabel)=>Rr(507,{h4:t},e.get("article",Ys)).outerHTML,theme(t){let n=e.get(`#${b.styleTheme}`);return void 0===t?n.href:la(n,t)},style(t){let n=e.get(`#${b.styleMain}`);return void 0===t?n.href:la(n,t)},codes(t){let n=e.get(`#${b.styleCodes}`);return void 0===t?n.href:la(n,t)}};function Zs(t){return e.isArray(t)?t:[t]}function ea(t){let n=e.get("h4",t);return[n&&e.html(n),e(">*",t).not("h4").prop("outerHTML").join("")]}function ta(t,n,r,l){let o=r&&e.get("h4",r),i=r&&e(">*",r).not("h4");Ls(l,Rr(l,{h4:t||o&&e.text(o)},n?[...e.fragment(n).children]:i,!0))}function na(t,n){let r=e.get("h4",t),l=e.get(`>${n}`,t);return[r&&e.html(r),l&&e.children(l).map((t=>e.html(t)))]}function ra(t,n,r,l,o){let i=r&&e.get("h4",r),s=r&&e.get(`>${l}`,r);n&&(s=e.elem(l),e.append(s,e(Zs(n)).wrap("<li>"))),Ls(o,Rr(o,{h4:t||i&&e.text(i)},s))}function la(t,n){return e.style({id:t.id,href:n},t).then((()=>e.remove(t)))}
//! $ID: main.js 2019.11.16 Cooljed.User $
window.GHK=(new p).config(N.Global),window.SHK=(new p).config(N.Slave),window.DHK=(new p).config(N.Modal),window.CHK=new h(qs).config(N.Content),window.Sys=_,window.Kit=Js,window.KM=N.Keys,window.edInit=function(t,l,o,i,s,a,u,c,f,d){jo=e.get(t),Po=e.get(l),Jo=e.get(o),Bo=e.get(i),Ko=e.get(s),Vo=e.get(a),Wo=e.get(u),Go=e.get(c),Xo=e.get(f),qo=e.get(d),Object.assign(Cs,{[x.select]:new Wl(Eo,jo),[x.filter]:new Gl(Eo),[x.search]:new Xl(jo),[x.command]:new ql(Eo),[x.calcuate]:new Jl(Eo,jo)}),ro(e.get("#x-help"),n.get(r).node(_.modalPlug)),e.on(jo,"attrdone styledone nodesdone emptied detach normalize propdone",null,No)},window.Api=Qs,window.ESC=new $n,e.config({varyevent:!0}),f.build(window,{on:`${_.recover}|savedhtml dup pass`,to:"main.content|html|fire('#g-refresh', 'click')"},v,g),f.init(v,g).config(l).then((e=>e.build(document))).then((()=>e.trigger(document.body,"finish"))).then((()=>Qs.init(e.get("main.content")))).then((()=>_.readyCall())).catch((e=>_.failCall(e))).then((()=>_.contenter())).then((t=>null!=t&&e.html(e.get("main.content"),t))),o&&(window.On=v,window.By=g,window.Tpls=n.get(r));export{kl as PlugBy,Al as PlugOn};
